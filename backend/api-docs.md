# API Documentation for Authentication

## Base URL
`http://localhost:3000`

## Endpoints

### 1. Register a User
- **Endpoint**: `POST api/auth/register`
- **Description**: Registers a user with email, password, username, and role (employer or jobseeker). Sends a verification email to confirm the email address. Users must verify their email before logging in. For admin or moderator registration, use separate endpoints with secretKey.
- **Headers**: 
  - x-fingerprint: <fingerprint> (Required, device fingerprint generated by FingerprintJS or similar)</fingerprint>
  - x-forwarded-for: <ip> (Optional, client IP address, defaults to request IP)</ip>
  - x-site-brand (optional) — явная метка бренда (jobforge, 22resumes, …). Если не передать — бэкенд попытается вывести её из Origin/Referer/Host.
- **Request Body**:
  ```json
  {
    "email": "user@example.com",
    "password": "StrongP@ssw0rd",
    "username": "jane",
    "role": "jobseeker", 
    "country": "US", 
    "skills": ["<categoryId1>", "<categoryId2>"],
    "experience": "3 years",
    "resume": "https://example.com/cv.pdf",
    "linkedin": "https://linkedin.com/in/...",
    "instagram": "https://instagram.com/...",
    "facebook": "https://facebook.com/...",
    "whatsapp": "+12025550123",
    "telegram": "@username",
    "description": "до 150 слов",
    "languages": ["English", "German"]
  }

- **Response (Success - 200)**:
  ```json
  {
    "message": "Registration is successful. Please confirm your email."
  }
  
- **Response (Error - 400, if email already exists)**:
  ```json
  {
    "statusCode": 400,
    "message": "Email already exists",
    "error": "Bad Request"
  }

- **Response (Error - 403, if country is blocked)**:
  ```json
  {
  "statusCode": 403,
  "message": "Registration is not allowed from your country",
  "error": "Forbidden"
  }

- **Response (Error - 400, if fingerprint is missing)**:
  ```json
  {
    "statusCode": 400,
    "message": "Fingerprint is required",
    "error": "Bad Request"
  }

### 1.1 Verify Email
- **Endpoint**: `GET api/auth/verify-email`
- **Description**: Verifies a user's email address using a token sent via email and auto-logins the user by redirecting to frontend with JWT token.
- **Query Parameters:**: `token`: (Required, token from the verification email)
- **Response (Success - 302 Redirect)**: Redirects to `${FRONTEND_URL}/auth/callback?token=<JWT>&verified=true`
  - `token`: JWT access token for auto-login.
  - `verified`: true if successful.

- **Response (Error - 400, if token is invalid or expired)**: Redirect to `${FRONTEND_URL}/auth/callback?error=invalid_token` or JSON:
  ```json
  {
    "statusCode": 400,
    "message": "Invalid or expired verification token",
    "error": "Bad Request"
  }

### 1.2 Resend Verification Email
- **Endpoint**: `POST /api/auth/resend-verification`
- **Description**: Sends a new email to verify the email if the account exists and has not yet been verified.
- **Request Body:**: 
  ```json
  { 
    "email": "user@example.com" 
  }
- **Response (Success - 200)**:
  ```json
  { 
    { "message": "If the account exists and is not verified, we sent a new link." }
  }

- **Response 429 (rate limit)**:
  ```json
  { "statusCode": 429, "message": "Please wait before requesting another verification email", "error": "Too Many Requests" }

### 2. Login a User
- **Endpoint**: `POST api/auth/login`
- **Description**: Logs in a user with email and password, returns a JWT token. Users must have verified their email before logging in.
- **Request Body**:
  ```json
  {
    "email": "test@example.com",
    "password": "password",
    "rememberMe": false // Optional, extends token expiry to 7 days if true
  }

- **Response (Success - 201)**:
  ```json
  {
    "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  }
  
- **Response (Error - 401, if credentials are invalid):**:
  ```json
  {
    "statusCode": 401,
    "message": "Invalid credentials",
    "error": "Unauthorized"
  }

- **Response (Error - 401, if email is not verified)**:
  ```json
  {
    "statusCode": 401,
    "message": "Please confirm your email before logging in",
    "error": "Unauthorized"
  }  

- **Response (Error - 401, if user is blocked):**:
  ```json
  {
    "statusCode": 401,
    "message": "User is blocked",
    "error": "Unauthorized"
  }

### 2.1 Forgot Password
- **Endpoint**: `POST api/auth/forgot-password`
- **Description**: Sends a password reset link to the user's email.
- **Request Body**:
  ```json
  {
    "email": "test@example.com"
  }

- **Response (Success - 201)**:
  ```json
  {
    "message": "Password reset link sent"
  }

- **Response (Error - 400, if user not found)**:
  ```json
  {
    "statusCode": 400,
    "message": "User not found",
    "error": "Bad Request"
  }

- **Response (Error - 401, if user is admin or moderator)**:
  ```json
  {
    "statusCode": 401,
    "message": "Password reset is not allowed for admin or moderator roles",
    "error": "Unauthorized"
  }

### 2.2 Reset Password
- **Endpoint**: `POST api/auth/reset-password`
- **Description**: Resets the user's password using a token from the reset email.
- **Request Body**:
  ```json
  {
    "token": "<resetToken>",
    "newPassword": "newpassword123"
  }

- **Response (Success - 201)**:
  ```json
  {
    "message": "Password successfully reset"
  }

- **Response (Error - 400, if token is invalid or expired)**:
  ```json
  {
    "statusCode": 400,
    "message": "Invalid or expired reset token",
    "error": "Bad Request"
  }

- **Response (Error - 401, if user is admin or moderator)**:
  ```json
  {
    "statusCode": 401,
    "message": "Password reset is not allowed for admin or moderator roles",
    "error": "Unauthorized"
  }

### 3. Logout a User
- **Endpoint**: `POST api/auth/logout`
- **Description**: Logs out a user by blacklisting the JWT token in Redis.
- **Headers**: `Authorization: Bearer <token>`
- **Request Body**: None

- **Response (Success - 201)**:
  ```json
  {
    "message": "Logout successful"
  }
  
- **Response (Error - 401, if token is invalid or already blacklisted)**:
  ```json
  {
    "statusCode": 401,
    "message": "Token already invalidated",
    "error": "Unauthorized"
  }    

- **Response (Error - 401, if token is missing or malformed)**:
  ```json
  {
    "statusCode": 401,
    "message": "Invalid token",
    "error": "Unauthorized"
  }

### 4. Google OAuth - Initiate Authentication
- **Endpoint**: `GET /api/auth/google`
- **Description**: Initiates the Google OAuth authentication process.
- **Query Parameters**: `role` (string, required): The role of the user ("employer" or "jobseeker").
- **Example Request**: `/api/auth/google?role=employer`
- **Response**: Redirects the user to Google's authentication page.

### 5. Google OAuth - Callback (handled by backend)
- **Endpoint**: `GET /api/auth/google/callback`
- **Description**: Handles the callback from Google after authentication. Redirects the user to a callback URL with a token and role for further processing.
- **Query Parameters**: 
  `code`: Authorization code from Google (handled automatically).
  `callbackUrl`: (optional): Custom URL to redirect to after authentication.
- **Response:**: Redirects to the specified callbackUrl or default /auth/callback with query parameters: /auth/callback?token=<jwt-token>&role=<employer|jobseeker>
  `token`: JWT token for user authentication.
  `role`: The role of the user ("employer" or "jobseeker").

- **Error Response (500, if authentication fails)**:
  ```json
  {
    "message": "Authentication failed",
    "error": "<error message>"
  }

### 5.1. Google OAuth - Login
- **Endpoint**: `POST /api/auth/google-login`
- **Description**: Completes the login process for a user authenticated via Google OAuth.
- **Request Body**: 
  ```json
  {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  }

- **Response (Success - 200)**:
  ```json
  {
    "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  }

- **Response (Error - 401, if token is invalid)**:
  ```json
  {
    "statusCode": 401,
    "message": "Invalid token",
    "error": "Unauthorized"
  }

### 6. Get Profile
- **Endpoint**: `GET /api/profile/myprofile`
- **Description**: Retrieves the authenticated user's profile based on their role.
- **Headers**: `Authorization: Bearer <token>`
- **Request Body**: None
- **Response (Success - 200)**: 
  //For employer
  ```json
  {
    "id": "<userId>",
    "role": "employer",
    "email": "test@example.com",
    "username": "test",
    "country": "US",
    "company_name": "Test Company",
    "company_info": "A great company",
    "referral_link": "https://example.com/ref/test",
    "timezone": "Europe/Moscow",
    "currency": "USD",
    "expected_salary": 4500.00,
    "average_rating": 4.5,
    "job_search_status": "open_to_offers",
    "avatar": "https://example.com/avatar.jpg",
    "identity_verified": true,
    "reviews": [
      {
        "id": "<reviewId>",
        "reviewer_id": "<userId>",
        "reviewed_id": "<userId>",
        "job_application_id": "<jobApplicationId>",
        "rating": 4,
        "comment": "Great work, very professional!",
        "created_at": "2025-05-13T18:00:00.000Z",
        "updated_at": "2025-05-13T18:00:00.000Z"
      }
    ]
  }
  //For jobseeker
  ```json
  {
    "id": "<userId>",
    "role": "jobseeker",
    "email": "test@example.com",
    "username": "test",
    "country": "US",
    "languages": ["English","German"],
    "skills": [
      {
        "id": "<skillId>",
        "name": "Web Development",
        "parent_id": "<parentSkillId>",
        "created_at": "2025-05-22T18:00:00.000Z",
        "updated_at": "2025-05-22T18:00:00.000Z"
      }
    ],
    "experience": "2 years",
    "linkedin": "https://www.linkedin.com/in/username",
    "instagram": "https://www.instagram.com/username",
    "facebook": "https://www.facebook.com/username",
    "description": "Experienced web developer specializing in React and Node.js",
    "portfolio": "https://portfolio.com",
    "video_intro": "https://video.com",
    "resume": "https://example.com/resume.pdf", // или "/uploads/resumes/filename.pdf
    "timezone": "Europe/Moscow",
    "currency": "USD",
    "average_rating": 4.0,
    "profile_views": 10,
    "avatar": "https://example.com/avatar.jpg",
    "identity_verified": false,
    "reviews": [
      {
        "id": "<reviewId>",
        "reviewer_id": "<userId>",
        "reviewed_id": "<userId>",
        "job_application_id": "<jobApplicationId>",
        "rating": 4,
        "comment": "Great work, very professional!",
        "created_at": "2025-05-22T18:00:00.000Z",
        "updated_at": "2025-05-22T18:00:00.000Z"
      }
    ]
  }
- **Response (Error - 401, if token is invalid or missing)**: 
  ```json
  {
    "statusCode": 401,
    "message": "Invalid token",
    "error": "Unauthorized"
  }

- **Response (Error - 404, if user or profile not found)**: 
  ```json
  {
    "statusCode": 404,
    "message": "User not found",
    "error": "Not Found"
  }

### 6.1. Get Profile by ID
- **Endpoint**: `GET /api/profile/:id`
- **Description**: Retrieves the profile of a specific user (jobseeker or employer) by their ID. Accessible to both authenticated and unauthenticated users. For unauthenticated users, sensitive information like email is omitted. For jobseeker profiles, the view count is incremented.
- **Headers**: `Authorization: Bearer <token>` (Optional)
- **Request Parameters**: `id`: The ID of the user.
- **Response (Success - 200)**: 
  // For employer (unauthenticated)
  ```json
  {
    "id": "<userId>",
    "role": "employer",
    "username": "test",
    "country": "US",
    "company_name": "Test Company",
    "company_info": "A great company",
    "referral_link": "https://example.com/ref/test",
    "timezone": "Europe/Moscow",
    "currency": "USD",
    "average_rating": 4.5,
    "job_search_status": "open_to_offers",
    "avatar": "https://example.com/avatar.jpg",
    "identity_verified": true,
    "reviews": [
      {
        "id": "<reviewId>",
        "reviewer_id": "<userId>",
        "reviewed_id": "<userId>",
        "job_application_id": "<jobApplicationId>",
        "rating": 4,
        "comment": "Great work, very professional!",
        "created_at": "2025-05-13T18:00:00.000Z",
        "updated_at": "2025-05-13T18:00:00.000Z"
      }
    ]
  }
  // For jobseeker (authenticated)
  ```json
  {
    "id": "<userId>",
    "role": "jobseeker",
    "email": "test@example.com",
    "username": "test",
    "country": "US",
    "languages": ["English","German"],
    "skills": [
      {
        "id": "<skillId>",
        "name": "Web Development",
        "parent_id": "<parentSkillId>",
        "created_at": "2025-05-22T18:00:00.000Z",
        "updated_at": "2025-05-22T18:00:00.000Z"
      }
    ],
    "experience": "2 years",
    "linkedin": "https://www.linkedin.com/in/username",
    "instagram": "https://www.instagram.com/username",
    "facebook": "https://www.facebook.com/username",
    "description": "Experienced web developer specializing in React and Node.js",
    "portfolio": "https://portfolio.com",
    "video_intro": "https://video.com",
    "resume": "https://example.com/resume.pdf", // "/uploads/resumes/filename.pdf
    "timezone": "Europe/Moscow",
    "currency": "USD",
    "average_rating": 4.0,
    "profile_views": 10,
    "avatar": "https://example.com/avatar.jpg",
    "identity_verified": false,
    "reviews": [
      {
        "id": "<reviewId>",
        "reviewer_id": "<userId>",
        "reviewed_id": "<userId>",
        "job_application_id": "<jobApplicationId>",
        "rating": 4,
        "comment": "Great work, very professional!",
        "created_at": "2025-05-22T18:00:00.000Z",
        "updated_at": "2025-05-22T18:00:00.000Z"
      }
    ]
  }

- **Response (Error - 404, if user or profile not found)**: 
  ```json
  {
    "statusCode": 404,
    "message": "User not found",
    "error": "Not Found"
  }

- **Response (Error - 401, if user role is not supported)**: 
  ```json
  {
    "statusCode": 401,
    "message": "User role not supported",
    "error": "Unauthorized"
  }

### 7. Update Profile
- **Endpoint**: `PUT /api/profile`
- **Description**: Updates the authenticated user's profile based on their role.
- **Headers**: `Authorization: Bearer <token>` 
- **Request Body**:
  //For employer
  ```json
  {
    "role": "employer",
    "company_name": "Updated Company",
    "company_info": "Updated info",
    "country": "DE",
    "referral_link": "https://example.com/ref/updated",
    "timezone": "America/New_York",
    "currency": "EUR"
  }
  //For jobseeker
  ```json
  {
    "role": "jobseeker",
    "country": "DE",
    "languages": ["English","German"],
    "skillIds": ["<skillId1>", "<skillId2>"],
    "experience": "3 years",
    "linkedin": "https://www.linkedin.com/in/username",
    "instagram": "https://www.instagram.com/username",
    "facebook": "https://www.facebook.com/username",
    "description": "Experienced web developer specializing in React and Node.js",
    "portfolio": "https://newportfolio.com",
    "video_intro": "https://newvideo.com",
    "job_search_status": "actively_looking", // Optional
    "resume": "https://example.com/resume.pdf", // Optional, link to resume (for file use upload-resume)
    "timezone": "America/New_York",
    "currency": "EUR",
    "expected_salary": 4500.00
  }

- **Response (Success - 200): Returns the updated profile (same format as GET /api/profile)**

- **Response (Error - 401, if token is invalid or missing)**:
  ```json
  {
    "statusCode": 401,
    "message": "Invalid token",
    "error": "Unauthorized"
  }

- **Response (Error - 404, if user or profile not found)**:
  ```json
  {
    "statusCode": 404,
    "message": "User not found",
    "error": "Not Found"
  }

- **Response (Error - 401, if role mismatch)**:
  ```json
  {
    "statusCode": 401,
    "message": "User role mismatch",
    "error": "Unauthorized"
  }

### 8. Create Job Post
- **Endpoint**: `POST /api/job-posts`
- **Description**: Creates a new job post for an authenticated employer. Supports multiple categories via category_ids. salary may be null if salary_type = 'negotiable'
- **Headers**: `Authorization: Bearer <token>`
- **Request Body**:
  ```json
  {
    "title": "Software Engineer",
    "description": "We are looking for a skilled software engineer.",
    "location": "Remote",
    "salary": 50000,
    "status": "Active",
    "job_type": "Full-time",
    "salary_type": "per month",
    "excluded_locations": ["India"],
    "category_ids": ["<catId1>", "<catId2>"],   // NEW (multi)
    "category_id": "<catId1>",                   // deprecated (для совместимости)
    "aiBrief": "Build and maintain web apps"
  }
- **Response (Success - 200)**:
  ```json
  {
    "id": "<jobPostId>",
    "title": "Software Engineer",
    "description": "We are looking for a skilled software engineer.",
    "location": "Remote",
    "salary": 50000,
    "status": "Active",
    "job_type": "Full-time",
    "salary_type": "per month",
    "excluded_locations": ["India"],
    "pending_review": true,
    "category_id": "<categoryId>",                 // legacy
    "category": {
      "id": "<categoryId>",
      "name": "Software Development",
      "created_at": "2025-05-15T06:12:00.000Z",
      "updated_at": "2025-05-15T06:12:00.000Z"
    },
    "category_ids": ["<catId1>", "<catId2>"],      // NEW
    "categories": [                                // NEW
      { "id": "<catId1>", "name": "Software Development" },
      { "id": "<catId2>", "name": "DevOps" }
    ],
    "employer_id": "<employerId>",
    "employer": {
      "id": "<employerId>",
      "email": "employer100@example.com",
      "username": "jane_smith100",
      "role": "employer"
    },
    "views": 0,
    "required_skills": ["JavaScript", "TypeScript"],
    "slug": "software-engineer-remote",
    "slug_id": "software-engineer-remote--8df3b0be",
    "created_at": "2025-05-15T06:12:00.000Z",
    "updated_at": "2025-05-15T06:12:00.000Z"
  }
- **Response (Error - 400, if salary is missing and salary_type is not 'negotiable')**:
  ```json
  {
    "statusCode": 400,
    "message": "Salary is required unless salary_type is negotiable",
    "error": "Bad Request"
  }
- **Response (Error - 401, if token is invalid or missing)**:
  ```json
  {
    "statusCode": 401,
    "message": "Invalid token",
    "error": "Unauthorized"
  }
- **Response (Error - 401, if user is not an employer)**:
  ```json
  {
    "statusCode": 401,
    "message": "Only employers can create job posts",
    "error": "Unauthorized"
  }
- **Response (Error - 404, if user not found)**:
  ```json
  {
    "statusCode": 404,
    "message": "User not found",
    "error": "Not Found"
  }

### 9. Update Job Post
- **Endpoint**: `PUT /api/job-posts/:id`
- **Description**: Updates an existing job post for an authenticated employer. Salary is optional if salary_type is 'negotiable'.
- **Headers**: `Authorization: Bearer <token>` 
- **Request Body**::
  ```json
  {
    "title": "Senior Software Engineer",
    "description": "Updated description.",
    "location": "Remote",
    "salary": 60000,
    "status": "Active",
    "job_type": "Full-time",
    "salary_type": "per month",
    "excluded_locations": ["India"],
    "category_ids": ["<catId1>", "<catId2>"],  // NEW
    "category_id": "<catId1>"                  // deprecated
  }
- **Response (Success - 200)**:
  ```json
  {
    "id": "<jobPostId>",
    "title": "Senior Software Engineer",
    "description": "Updated description.",
    "location": "Remote",
    "salary": 60000,
    "status": "Active",
    "job_type": "Full-time",
    "salary_type": "per month",
    "excluded_locations": ["India"],
    "pending_review": false,

    "category_id": "<categoryId>",                  // legacy
    "category": {
      "id": "<categoryId>",
      "name": "Software Development",
      "created_at": "2025-05-15T06:12:00.000Z",
      "updated_at": "2025-05-15T06:12:00.000Z"
    },
    "category_ids": ["<catId1>", "<catId2>"],       // NEW
    "categories": [                                  // NEW
      { "id": "<catId1>", "name": "Software Development" },
      { "id": "<catId2>", "name": "DevOps" }
    ],

    "employer_id": "<employerId>",
    "employer": {
      "id": "<employerId>",
      "email": "employer100@example.com",
      "username": "jane_smith100",
      "role": "employer"
    },
    "views": 0,
    "required_skills": ["JavaScript", "TypeScript"],
    "slug": "senior-software-engineer-remote",
    "slug_id": "senior-software-engineer-remote--8df3b0be",
    "created_at": "2025-05-15T06:12:00.000Z",
    "updated_at": "2025-05-15T06:30:00.000Z"
  }
- **Response (Error - 400, if salary is missing and salary_type is not 'negotiable')**:
  ```json
  {
    "statusCode": 400,
    "message": "Salary is required unless salary_type is negotiable",
    "error": "Bad Request"
  }
- **Response (Error - 401, if token is invalid or missing)**:
  ```json
  {
    "statusCode": 401,
    "message": "Invalid token",
    "error": "Unauthorized"
  }
- **Response (Error - 404, if job post not found or user does not have permission)**:
  ```json
  {
    "statusCode": 404,
    "message": "Job post not found or you do not have permission to update it",
    "error": "Not Found"
  }

### 9.1 Generate Job Description (AI)
- **Endpoint**: `POST /api/job-posts/generate-description`
- **Description**: Generates a job description using AI based on a brief (for employers only). If salary_type is 'negotiable', salary can be omitted and description will show "Negotiable".
- **Headers**: `Authorization: Bearer <token>` (Required for employers)
- **Request Body**::
  ```json
  {
    "aiBrief": "Need Python developer with 3 years experience for web app. Skills: Django, SQL."
  }
- **Response (Success - 200)**::
  ```json
  {
    "description": "<html_formatted_description>"
  }
- **Response (Error - 400, if aiBrief missing)**:
  ```json
  {
    "statusCode": 400,
    "message": "AI brief is required",
    "error": "Bad Request"
  }

- **Response (Error - 500, AI fail)**:
  ```json
  {
    "statusCode": 500,
    "message": "Failed to generate description with AI",
    "error": "Internal Server Error"
  }

### 10. Get Job Post
- **Endpoint**: `GET /api/job-posts/:id`
- **Description**: Retrieves a specific job post by ID. If salary_type is 'negotiable', salary can be null and UI should display "Negotiable".
- **Request Parameters**: `id`: The ID of the job post.
- **Response (Success - 200)**:
  ```json
  {
    "id": "<jobPostId>",
    "title": "Software Engineer",
    "description": "Develop and maintain web applications.",
    "location": "Remote",
    "salary": null,
    "status": "Active",
    "job_type": "Full-time",
    "salary_type": "negotiable",
    "excluded_locations": ["India"],
    "pending_review": false,

    "category_id": "<categoryId>",                 // legacy
    "category": { "id": "<categoryId>", "name": "Development" },
    "category_ids": ["<catId1>", "<catId2>"],      // NEW
    "categories": [                                 // NEW
      { "id": "<catId1>", "name": "Development" },
      { "id": "<catId2>", "name": "Writing" }
    ],

    "employer_id": "<userId>",
    "employer": {
      "id": "<userId>",
      "username": "employer1",
      "email": "employer@example.com",
      "role": "employer"
    },
    "views": 10,
    "slug": "software-engineer-remote",
    "slug_id": "software-engineer-remote--8df3b0be",
    "created_at": "2025-07-08T07:00:00.000Z",
    "updated_at": "2025-07-08T07:00:00.000Z"
  }
- **Response (Error - 404, if job post not found)**:  
  ```json
  {
    "statusCode": 404,
    "message": "Job post not found",
    "error": "Not Found"
  }

### 10.1 Get Job Post by Slug or ID
- **Endpoint**: `GET /api/job-posts/by-slug-or-id/:slugOrId`
- **Description**: Возвращает вакансию по slug_id, slug или по UUID id. Приоритет: slug_id → slug → id.
- **Request Parameters**: `id`: The ID of the job post.
- **Response (Success - 200)**:
  ```json
  {
    "id": "<jobPostId>",
    "title": "Software Engineer",
    "description": "Develop and maintain web applications.",
    "location": "Remote",
    "salary": null,
    "status": "Active",
    "category_id": "<catId1>",                    // legacy
    "category_ids": ["<catId1>", "<catId2>"],     // NEW
    "categories": [
      { "id": "<catId1>", "name": "Development" },
      { "id": "<catId2>", "name": "Writing" }
    ],
    "job_type": "Full-time",
    "salary_type": "negotiable",
    "employer_id": "<userId>",
    "views": 10,
    "pending_review": false,
    "slug": "software-engineer-remote",
    "slug_id": "software-engineer-remote--8df3b0be",
    "created_at": "2025-07-08T07:00:00.000Z",
    "updated_at": "2025-07-08T07:00:00.000Z"
  }
- **Response (Error - 404, if job post not found)**:  
  ```json
  {
    "statusCode": 404,
    "message": "Job post not found",
    "error": "Not Found"
  }

### 11. Get Job Posts by Employer
- **Endpoint**: `GET /api/job-posts/my-posts`
- **Description**: Retrieves all job posts created by the authenticated employer.
- **Headers**: `Authorization: Bearer <token>`
- **Response (Success - 200)**:  
  ```json
  [
    {
      "id": "<jobPostId>",
      "title": "Senior Software Engineer",
      "description": "Updated description.",
      "location": "Remote",
      "salary": 60000,
      "salary_type": "per month",
      "excluded_locations": ["India"],
      "status": "Closed",
      "job_type": "Full-time",
      "pending_review": false,
      "category_id": "<categoryId>",                 // legacy
      "category": {
        "id": "<categoryId>",
        "name": "Software Development",
        "created_at": "2025-05-13T18:00:00.000Z",
        "updated_at": "2025-05-13T18:00:00.000Z"
      },
      "category_ids": ["<catId1>", "<catId2>"],      // NEW
      "categories": [                                 // NEW
        { "id": "<catId1>", "name": "Software Development" },
        { "id": "<catId2>", "name": "DevOps" }
      ],

      "employer_id": "<userId>",
      "employer": {
        "id": "<userId>",
        "email": "test15@example.com",
        "username": "test15",
        "role": "employer"
      },
      "created_at": "2025-05-13T18:00:00.000Z",
      "updated_at": "2025-05-13T18:30:00.000Z"
    }
  ]
- **Response (Error - 401, if token is invalid or missing)**:
  ```json
  {
    "statusCode": 401,
    "message": "Invalid token",
    "error": "Unauthorized"
  }
- **Response (Error - 401, if user is not an employer)**:
  ```json
  {
    "statusCode": 401,
    "message": "Only employers can view their job posts",
    "error": "Unauthorized"
  }
- **Response (Error - 404, if user not found)**:
  ```json
  {
    "statusCode": 404,
    "message": "User not found",
    "error": "Not Found"
  }

### 12. Create Category (Admin)
- **Endpoint**: `POST /api/admin/categories`
- **Description**: Creates a new category or subcategory for job posts and jobseeker skills (admin only).
- **Headers**: `Authorization: Bearer <token>`
- **Request Body**:
  ```json
  {
    "name": "Software Development",
    "parentId": "<parentCategoryId>" // Optional, for subcategories
  }
- **Response (Success - 200)**:
  ```json
  {
    "id": "<categoryId>",
    "name": "Software Development",
    "parent_id": "<parentCategoryId>",
    "created_at": "2025-05-13T18:00:00.000Z",
    "updated_at": "2025-05-13T18:00:00.000Z"
  }
- **Response (Error - 400, if category already exists)**:
  ```json
  {
    "statusCode": 400,
    "message": "Category with this name already exists",
    "error": "Bad Request"
  }
- **Response (Error - 400, if parent category not found)**:
  ```json
  {
    "statusCode": 400,
    "message": "Parent category not found",
    "error": "Bad Request"
  }
- **Response (Error - 400, if name is missing)**:
  ```json
  {
    "statusCode": 400,
    "message": "Category name is required",
    "error": "Bad Request"
  }
- **Response (Error - 401, if token is invalid or user is not an admin)**:
  ```json
  {
    "statusCode": 401,
    "message": "Invalid token",
    "error": "Unauthorized"
  } 

### 13. Get Categories (Admin/Moderator)
- **Endpoint**: `GET /api/admin/categories`
- **Description**: Retrieves all categories in a hierarchical tree structure (admin or moderator only).
- **Headers**: `Authorization: Bearer <token>`
- **Response (Success - 200)**:
  ```json
  [
    {
      "id": "<categoryId>",
      "name": "Office and Admin",
      "parent_id": null,
      "created_at": "2025-05-13T18:00:00.000Z",
      "updated_at": "2025-05-13T18:00:00.000Z",
      "subcategories": [
        {
          "id": "<subcategoryId>",
          "name": "Virtual Assistant",
          "parent_id": "<categoryId>",
          "created_at": "2025-05-13T18:00:00.000Z",
          "updated_at": "2025-05-13T18:00:00.000Z",
          "subcategories": []
        }
      ]
    },
    {
      "id": "<categoryId>",
      "name": "Writing",
      "parent_id": null,
      "created_at": "2025-05-13T18:00:00.000Z",
      "updated_at": "2025-05-13T18:00:00.000Z",
      "subcategories": [
        {
          "id": "<subcategoryId>",
          "name": "Content Writers",
          "parent_id": "<categoryId>",
          "created_at": "2025-05-13T18:00:00.000Z",
          "updated_at": "2025-05-13T18:00:00.000Z",
          "subcategories": []
        }
      ]
    }
  ]
- **Response (Error - 401, if token is invalid or user is not an admin)**:
  ```json
  {
    "statusCode": 401,
    "message": "Invalid token",
    "error": "Unauthorized"
  }

### 13.1. Search Categories (Admin/Moderator)
- **Endpoint**: `GET /api/admin/categories/search`
- **Description**: Searches categories by name (partial match, case-insensitive, admin or moderator only).
- **Headers**: `Authorization: Bearer <token>`
- **Query Parameters**: `term` (string, required): Search term for category names.
- **Example Request**: `/api/admin/categories/search?term=Web`
- **Response (Success - 200)**:
  ```json
  [
    {
      "id": "<categoryId>",
      "name": "Web Development",
      "parent_id": "<parentCategoryId>",
      "created_at": "2025-05-13T18:00:00.000Z",
      "updated_at": "2025-05-13T18:00:00.000Z"
    }
  ]
- **Response (Error - 400, if search term is missing)**:
    ```json
  {
    "statusCode": 400,
    "message": "Search term is required",
    "error": "Bad Request"
  }
- **Response (Error - 401, if token is invalid or user is not an admin)**:
  ```json
  {
    "statusCode": 401,
    "message": "Invalid token",
    "error": "Unauthorized"
  }

### 13.2. Get Categories (Public)
- **Endpoint**: `GET /api/categories`
- **Description**: Returns the hierarchical tree of categories. Optionally includes the total number of active, approved job posts per category (including all descendants).
- **Headers**: None
- **Query Parameters (optional)**:
  - `includeCounts` — true|false (default false). When true, each category object includes jobs_count.
  - `onlyTopLevel` — true|false (default false). When true, returns only root categories (useful for the homepage widget).
- **Response (200) — when includeCounts=true**:
  ```json
  [
    {
      "id": "<categoryId>",
      "name": "Office and Admin",
      "parent_id": null,
      "created_at": "2025-05-13T18:00:00.000Z",
      "updated_at": "2025-05-13T18:00:00.000Z",
      "jobs_count": 124,
      "subcategories": [
        {
          "id": "<subcategoryId>",
          "name": "Virtual Assistant",
          "parent_id": "<categoryId>",
          "created_at": "2025-05-13T18:00:00.000Z",
          "updated_at": "2025-05-13T18:00:00.000Z",
          "jobs_count": 37,
          "subcategories": []
        }
      ]
    }
  ]

### 13.3. Search Categories (Public)
- **Endpoint**: `GET /api/categories/search`
- **Description**: Searches categories by name (partial match, case-insensitive), accessible to all users (including unauthenticated).
- **Headers**: `Authorization: Bearer <token>`
- **Query Parameters**: `term` (string, required): Search term for category names.
- **Example Request**: `/api/categories/search?term=Web`
- **Response (Success - 200)**:
  ```json
  [
    {
      "id": "<categoryId>",
      "name": "Web Development",
      "parent_id": "<parentCategoryId>",
      "created_at": "2025-05-13T18:00:00.000Z",
      "updated_at": "2025-05-13T18:00:00.000Z"
    }
  ]
- **Response (Error - 400, if search term is missing)**:
    ```json
  {
    "statusCode": 400,
    "message": "Search term is required",
    "error": "Bad Request"
  }

### 13.4. Delete Category (Admin)
- **Endpoint**: `DELETE /api/admin/categories/:id`
- **Description**: Deletes a specific category or subcategory (admin only). Checks for subcategories, associated job posts, and jobseeker profiles. If job posts are linked, their `category_id` is set to `null`. If used in jobseeker profiles, the category is removed from their skills.
- **Headers**: `Authorization: Bearer <token>`
- **Request Parameters**: `id` (string, required): The ID of the category to delete.
- **Response (Success - 200)**:
  ```json
  {
    "message": "Category successfully deleted"
  }
- **Response (Error - 400, if category has subcategories)**:
  ```json
  {
    "statusCode": 400,
    "message": "You cannot delete a category that contains subcategories. First remove subcategories.",
    "error": "Bad Request"
  }
- **Response (Error - 401, if token is invalid or user is not an admin)**:
  ```json
  {
    "statusCode": 401,
    "message": "Invalid token",
    "error": "Unauthorized"
  }
- **Response (Error - 404, if category not found)**:
  ```json
  {
    "statusCode": 404,
    "message": "Category not found",
    "error": "Not Found"
  }  

### 14. Apply to Job Post
- **Endpoint**: `POST /api/job-applications`
- **Description**: Allows a jobseeker to apply to a job post. Applications are limited per job post (default: 100) and distributed cumulatively over 4 days (60%, 80%, 90%, 100%). If the daily limit is reached, a "Daily application limit reached" error is returned. If the total limit is reached, a "Job full" error is returned. Applicants from excluded_locations are blocked.
- **Headers**: `Authorization: Bearer <token>`
- **Request Body**:
  ```json
  {
    "job_post_id": "<jobPostId>",
    "cover_letter": "Why I'm a good fit...",
    "relevant_experience": "Describe relevant experience (companies, roles, stack, achievements...)",
    "full_name": "Jane Mary Doe",
    "referred_by": "Alex Petrov / john@company.com"
  }
- **Response (Success - 200)**:
  ```json
  {
    "id": "<applicationId>",
    "job_post_id": "<jobPostId>",
    "job_seeker_id": "<userId>",
    "status": "Pending",
    "cover_letter": "Why I'm a good fit...",
    "relevant_experience": "Describe relevant experience...",
    "full_name": "Jane Mary Doe",
    "referred_by": "Alex Petrov / john@company.com",
    "created_at": "2025-09-25T12:00:00.000Z",
    "updated_at": "2025-09-25T12:00:00.000Z"
  }
- **Response (Error - 400, if daily limit reached)**:
  ```json
  {
    "statusCode": 400,
    "message": "Daily application limit reached",
    "error": "Bad Request"
  }
- **Response (Error - 400, if location excluded)**:
  ```json
  {
    "statusCode": 400,
    "message": "Applicants from your location are not allowed",
    "error": "Bad Request"
  }
- **Response (Error - 401, if token is invalid or missing)**:
  ```json
  {
    "statusCode": 401,
    "message": "Invalid token",
    "error": "Unauthorized"
  }
- **Response (Error - 401, if user is not a jobseeker)**:  
  ```json
  {
    "statusCode": 401,
    "message": "Only jobseekers can apply to job posts",
    "error": "Unauthorized"
  }
- **Response (Error - 404, if job post not found)**: 
  ```json
  {
    "statusCode": 404,
    "message": "Job post not found",
    "error": "Not Found"
  }
- **Response (Error - 400, if job post is not active)**: 
  ```json
  {
    "statusCode": 400,
    "message": "Cannot apply to a job post that is not active",
    "error": "Bad Request"
  }
- **Response (Error - 400, if user already applied)**: 
  ```json
  {
    "statusCode": 400,
    "message": "You have already applied to this job post",
    "error": "Bad Request"
  }
- **Response (Error - 400, if application limit reached)**: 
  ```json
  {
    "statusCode": 400,
    "message": "Job full",
    "error": "Bad Request"
  }
- **Response (Error - 400, if application period ended)**: 
  ```json
  {
    "statusCode": 400,
    "message": "Application period has ended",
    "error": "Bad Request"
  }

### 15. Close Job Post
- **Endpoint**: `POST /api/job-posts/:id/close`
- **Description**: Closes a job post (sets status to "Closed"). Only the employer who created the job can close it.
- **Headers**: `Authorization: Bearer <token>`
- **Request Parameters**: `id`: The ID of the job post.
- **Response (Success - 200)**: 
  ```json
  {
    "id": "<jobPostId>",
    "title": "Software Engineer",
    "description": "We are looking for a skilled software engineer...",
    "location": "Remote",
    "salary": 50000,
    "status": "Closed",
    "category_id": "<categoryId>",
    "job_type": "Full-time",
    "employer_id": "<userId>",
    "applicationLimit": 100,
    "created_at": "2025-05-15T05:13:00.000Z",
    "updated_at": "2025-05-15T05:13:00.000Z"
  }

- **Response (Error - 404, if job post not found)**: 
  ```json
  {
    "statusCode": 404,
    "message": "Job post not found or you do not have permission to close it",
    "error": "Not Found"
  }

- **Response (Error - 400, if already closed)**: 
  ```json
  {
    "statusCode": 400,
    "message": "Job post is already closed",
    "error": "Bad Request"
  }

### 16. Get My Applications (Jobseeker)
- **Endpoint**: `GET /api/job-applications/my-applications`
- **Description**: Retrieves all applications submitted by the authenticated jobseeker.
- **Headers**: `Authorization: Bearer <token>`
- **Response (Success - 200)**: 
  ```json
  [
  {
    "id": "<applicationId>",
    "job_post_id": "<jobPostId>",
    "job_seeker_id": "<userId>",
    "status": "Pending",
    "job_post": {
      "id": "<jobPostId>",
      "title": "Software Engineer",
      "description": "We are looking for a skilled software engineer...",
      "location": "Remote",
      "salary": 50000,
      "status": "Active",
      "category_id": "<categoryId>",
      "employer_id": "<employerId>",
      "created_at": "2025-05-13T18:00:00.000Z",
      "updated_at": "2025-05-13T18:00:00.000Z"
    },
    "job_seeker": {
      "id": "<userId>",
      "email": "jobseeker1@example.com",
      "username": "jobseeker1",
      "role": "jobseeker"
    },
    "created_at": "2025-05-13T18:00:00.000Z",
    "updated_at": "2025-05-13T18:00:00.000Z"
  }
  ]

- **Response (Error - 401, if token is invalid or missing)**: 
  ```json
  {
    "statusCode": 401,
    "message": "Invalid token",
    "error": "Unauthorized"
  }

- **Response (Error - 401, if user is not a jobseeker)**: 
  ```json
  {
    "statusCode": 401,
    "message": "Only jobseekers can view their applications",
    "error": "Unauthorized"
  }

- **Response (Error - 404, if user not found)**:   
  ```json
  {
    "statusCode": 404,
    "message": "User not found",
    "error": "Not Found"
  }

### 17. Get Applications for Job Post (Employer)
- **Endpoint**: `GET /api/job-applications/job-post/:id`
- **Description**: Retrieves all applications for a specific job post, accessible only to the employer who created the job post.
- **Headers**: `Authorization: Bearer <token>`
- **Path Parameters**: 
  - `id` (string, required): The ID of the job post.
- **Response (Success - 200)**:  
  ```json
  [
    {
      "applicationId": "<applicationId>",
      "userId": "<jobseekerId>",
      "username": "john_doe107",
      "email": "jobseeker107@example.com",
      "jobDescription": "Experienced web developer with 5 years in React.",
      "coverLetter": "I am excited to apply for this position...",
      "fullName": "Jane Mary Doe",
      "referredBy": "Alex Petrov",
      "appliedAt": "2025-05-15T06:12:00.000Z",
      "status": "Pending",
      "job_post_id": "<jobPostId>"
    }
  ]

- **Response (Error - 401, if token is invalid or missing)**:  
  ```json
  {
    "statusCode": 401,
    "message": "Invalid token",
    "error": "Unauthorized"
  }

- **Response (Error - 401, if user is not the employer of this job post)**:   
  ```json
  {
    "statusCode": 401,
    "message": "Only employers can view applications for their job posts",
    "error": "Unauthorized"
  }

- **Response (Error - 404, if job post not found or user does not have permission)**:   
  ```json
  {
    "statusCode": 404,
    "message": "Job post not found or you do not have permission to view its applications",
    "error": "Not Found"
  }

### 17.1 Get Application by ID (Employer/Admin/Moderator)
- **Endpoint**: `GET /api/job-applications/:id`
- **Description**: Retrieves details of a specific job application by ID. Accessible to employers (who own the job post), admins, or moderators.
- **Headers**: `Authorization: Bearer <token>`
- **Request Parameters**: `id`: The ID of the job application.
- **Response (Success - 200)**:
  ```json
  {
    "applicationId": "<applicationId>",
    "userId": "<jobseekerId>",
    "username": "john_doe",
    "email": "john@example.com",
    "jobDescription": "Experienced web developer with 5 years in React",
    "coverLetter": "I am excited to apply for this position...",
    "appliedAt": "2025-05-15T06:12:00.000Z",
    "status": "Pending",
    "job_post_id": "<jobPostId>",
    "job_post": {
      "id": "<jobPostId>",
      "title": "Software Engineer",
      "status": "Active"
    }
  }
- **Response (Error - 401, if token is invalid or missing)**:
  ```json
  {
    "statusCode": 401,
    "message": "Invalid token",
    "error": "Unauthorized"
  }
- **Response (Error - 401, if user does not have permission)**:
  ```json
  {
    "statusCode": 401,
    "message": "Only employers, admins, or moderators can view application details",
    "error": "Unauthorized"
  }
- **Response (Error - 401, if employer does not own the job post)**:
  ```json
  {
    "statusCode": 401,
    "message": "You do not have permission to view this application",
    "error": "Unauthorized"
  }
- **Response (Error - 404, if application not found)**:
  ```json
  {
    "statusCode": 404,
    "message": "Application not found",
    "error": "Not Found"
  }

### 18. Update Application Status (Employer)
- **Endpoint**: `PUT /api/job-applications/:id`
- **Description**: Updates the status of a job application, accessible only to the employer who created the job post.
- **Headers**: `Authorization: Bearer <token>`  
- **Request Parameters**: `id`: The ID of the job application
- **Note**: Only one application can be set to "Accepted" per job post. When an application is accepted, the job post is automatically closed (status set to "Closed"). **All other applications with status "Pending" for the same job post are automatically set to "Rejected".
- **Request Body**:   
  ```json
  {
    "status": "Accepted" // or "Rejected"
  }
- **Response (Success - 200)**: 
  ```json
  {
    "id": "<applicationId>",
    "job_post_id": "<jobPostId>",
    "job_seeker_id": "<userId>",
    "status": "Accepted",
    "created_at": "2025-05-13T18:00:00.000Z",
    "updated_at": "2025-05-13T18:30:00.000Z"
  }

- **Response (Success - 400)**: 
  ```json
  {
    "statusCode": 400,
    "message": "Only one application can be accepted per job post",
    "error": "Bad Request"
  }    

- **Response (Error - 401, if token is invalid or missing)**:   
  ```json
  {
    "statusCode": 401,
    "message": "Invalid token",
    "error": "Unauthorized"
  }

- **Response (Error - 401, if user is not an employer)**:     
  ```json
  {
    "statusCode": 401,
    "message": "Only employers can update application status",
    "error": "Unauthorized"
  }

- **Response (Error - 401, if user does not have permission)**:
  ```json
  {
    "statusCode": 401,
    "message": "You do not have permission to update this application",
    "error": "Unauthorized"
  }

- **Response (Error - 401, if user does not have permission)**:
  ```json
  {
    "statusCode": 404,
    "message": "Application not found",
    "error": "Not Found"
  }

### 19. Get All Job Posts
- **Endpoint**: `GET /api/job-posts`
- **Description**: Searches for active and approved job posts with optional filters. If salary_type is 'negotiable', salary can be null and UI should display "Negotiable".
- **Query Parameters**:
  - `title` (string, optional): Filter by job title (partial match).
  - `location` (string, optional): Filter by location (partial match).
  - `job_type` (string, optional): Filter by job type ("Full-time", "Part-time", "Project-based").
  - `salary_min` (optional): Filter by minimum salary (ignored if salary_type is 'negotiable').
  - `salary_max` (optional): Filter by maximum salary (ignored if salary_type is 'negotiable').
  - `salary_type` (optional): Filter by salary type ('per hour', 'per month', 'negotiable').
  - `category_ids` (array или comma-list, optional): Filter by category ID. Примеры: ?category_ids[]=<id1>&category_ids[]=<id2> или ?category_ids=<id1>,<id2>
  - `required_skills` (string or string[], optional): Filter by required skills (e.g., "required_skills=JavaScript" or "required_skills[]=JavaScript&required_skills[]=Python").
  - `page` (number, optional): Page number for pagination (default: 1).
  - `limit` (number, optional): Number of items per page (default: 10).
  - `sort_by` (string, optional): Field to sort by ("created_at" or "salary", default: "created_at").
  - `sort_order` (string, optional): Sort order ("ASC" or "DESC", default: "DESC").
- **Example Request**: `/api/job-posts?title=Engineer&location=Remote&job_type=Full-time&category_ids=<id1>,<id2>&salary_type=per%20hour`
- **Response (Success - 200)**:
  ```json
  {
    "total": 50,
    "data": [
      {
        "id": "<jobPostId>",
        "title": "Software Engineer",
        "description": "Develop and maintain web applications.",
        "location": "Remote",
        "salary": null,
        "status": "Active",
        "job_type": "Full-time",
        "salary_type": "negotiable",
        "excluded_locations": ["India"],
        "pending_review": false,

        "category_id": "<catId1>",                    // legacy
        "category": { "id": "<catId1>", "name": "Development" },
        "category_ids": ["<catId1>", "<catId2>"],     // NEW
        "categories": [                                // NEW
          { "id": "<catId1>", "name": "Development" },
          { "id": "<catId2>", "name": "Writing" }
        ],

        "employer_id": "<userId>",
        "employer": {
          "id": "<userId>",
          "username": "employer1",
          "email": "employer@example.com",
          "role": "employer"
        },
        "views": 10,
        "slug": "software-engineer-remote",
        "slug_id": "software-engineer-remote--8df3b0be",
        "created_at": "2025-07-08T07:00:00.000Z",
        "updated_at": "2025-07-08T07:00:00.000Z"
      }
    ]
  }

### 20. Create Review
- **Endpoint**: `POST /api/reviews`
- **Description**: Creates a review for a user (employer or jobseeker) related to a specific job application.
- **Headers**: `Authorization: Bearer <token>`
- **Request Body**:
  ```json
  {
    "job_application_id": "<jobApplicationId>",
    "rating": 4,
    "comment": "Great work, very professional!"
  }

- **Response (Success - 200)**:
  ```json
  {
    "id": "<reviewId>",
    "reviewer_id": "<userId>",
    "reviewed_id": "<userId>",
    "job_application_id": "<jobApplicationId>",
    "rating": 4,
    "comment": "Great work, very professional!",
    "created_at": "2025-05-13T18:00:00.000Z",
    "updated_at": "2025-05-13T18:00:00.000Z"
  }

- **Response (Error - 401, if token is invalid or missing)**:
  ```json
  {
    "statusCode": 401,
    "message": "Invalid token",
    "error": "Unauthorized"
  }

- **Response (Error - 401, if user does not have permission)**:
  ```json
  {
    "statusCode": 401,
    "message": "You can only leave reviews for your own job applications",
    "error": "Unauthorized"
  }

- **Response (Error - 400, if job application is not accepted)**:
  ```json
  {
    "statusCode": 400,
    "message": "Reviews can only be left for accepted job applications",
    "error": "Bad Request"
  }

- **Response (Error - 400, if rating is invalid)**:
  ```json
  {
    "statusCode": 400,
    "message": "Rating must be between 1 and 5",
    "error": "Bad Request"
  }

- **Response (Error - 400, if review already exists)**:
  ```json
  {
    "statusCode": 400,
    "message": "You have already left a review for this job application",
    "error": "Bad Request"
  }

- **Response (Error - 404, if job application not found)**:
  ```json
  {
    "statusCode": 404,
    "message": "Job application not found",
    "error": "Not Found"
  }

### 21. Get Reviews for User
- **Endpoint**: `GET /api/reviews/user/:id`
- **Description**: Retrieves all reviews for a specific user (employer or jobseeker).
- **Headers**: `Authorization: Bearer <token>`
- **Request Parameters**: `id`: The ID of the user
- **Response (Success - 200)**:
  ```json
  [
  {
    "id": "<reviewId>",
    "reviewer_id": "<userId>",
    "reviewed_id": "<userId>",
    "job_application_id": "<jobApplicationId>",
    "rating": 4,
    "comment": "Great work, very professional!",
    "reviewer": {
      "id": "<userId>",
      "email": "employer4@example.com",
      "username": "employer4",
      "role": "employer"
    },
    "job_application": {
      "id": "<jobApplicationId>",
      "job_post_id": "<jobPostId>",
      "job_seeker_id": "<userId>",
      "status": "Accepted"
    },
    "created_at": "2025-05-13T18:00:00.000Z",
    "updated_at": "2025-05-13T18:00:00.000Z"
  }
  ]

- **Response (Error - 404, if user not found)**:
  ```json
  {
    "statusCode": 404,
    "message": "User not found",
    "error": "Not Found"
  }

### 22. Get All Users (Admin)
- **Endpoint**: `GET /api/admin/users`
- **Description**: Получает список пользователей с фильтрами и пагинацией (только для админа). Поиск по `username`, `email`, `id` работает как OR (достаточно совпадения любого из полей).
- **Headers**: `Authorization: Bearer <token>`
- **Query Parameters**:
  - `username` (string, optional): Фильтр по username (partial, case-insensitive).
  - `email` (string, optional): Фильтр по email (partial, case-insensitive).
  - `id` (string, optional): Фильтр по user ID (точное совпадение).
  - `createdAfter` (string, optional): Пользователи, созданные после даты (формат: YYYY-MM-DD).
  - `role` (string, optional): "employer" | "jobseeker" | "admin" | "moderator".
  - `status` (string, optional): "active" | "blocked".
  - `page` (number, optional): Номер страницы (default: 1).
  - `limit` (number, optional): Кол-во элементов на странице (default: 10).
- **Example Request**:  
  `/api/admin/users?username=test&email=example.com&id=123&createdAfter=2025-01-01&role=jobseeker&status=active&page=1&limit=10`
- **Response (Success - 200)**:
  ```json
  {
    "total": 42,
    "data": [
      {
        "id": "<userId>",
        "email": "test@example.com",
        "username": "test",
        "role": "jobseeker",
        "status": "active",
        "created_at": "2025-05-13T18:00:00.000Z",
        "last_seen_at": "2025-09-03T10:17:42.000Z",
        "updated_at": "2025-05-13T18:00:00.000Z"
      }
    ]
  }

- **Response (Error - 401, if token is invalid or missing)**: 
  ```json
  {
    "statusCode": 401,
    "message": "Invalid token",
    "error": "Unauthorized"
  }

- **Response (Error - 401, if user is not an admin)**: 
  ```json
  {
    "statusCode": 401,
    "message": "Only admins can access this resource",
    "error": "Unauthorized"
  }

### 23. Get User by ID (Admin)
- **Endpoint**: `GET /api/admin/users/:id`
- **Description**: Retrieves a specific user by ID (admin only).
- **Headers**: `Authorization: Bearer <token>`
- **Request Parameters**: `id`: The ID of the user.
- **Response (Success - 200)**: 
  ```json
  {
    "id": "<userId>",
    "email": "test@example.com",
    "username": "test",
    "role": "employer",
    "provider": null,
    "created_at": "2025-05-13T18:00:00.000Z",
    "last_seen_at": "2025-09-03T10:17:42.000Z",
    "updated_at": "2025-05-13T18:00:00.000Z"
  }

- **Response (Error - 404, if user not found)**: 
  ```json
  {
    "statusCode": 404,
    "message": "User not found",
    "error": "Not Found"
  }

### 24. Update User (Admin)
- **Endpoint**: `PUT /api/admin/users/:id`
- **Description**: Updates a specific user (admin only).
- **Headers**: `Authorization: Bearer <token>`
- **Request Parameters**: `id`: The ID of the user.
- **Request Body**: 
  ```json
  {
    "email": "updated@example.com",
    "username": "updatedUser",
    "role": "jobseeker"
  }

- **Response (Success - 200)**: 
  ```json
  {
    "id": "<userId>",
    "email": "updated@example.com",
    "username": "updatedUser",
    "role": "jobseeker",
    "provider": null,
    "created_at": "2025-05-13T18:00:00.000Z",
    "updated_at": "2025-05-13T18:30:00.000Z"
  }

- **Response (Error - 404, if user not found)**: 
  ```json
  {
    "statusCode": 404,
    "message": "User not found",
    "error": "Not Found"
  }

### 25. Delete User (Admin)
- **Endpoint**: `DELETE /api/admin/users/:id`
- **Description**: Deletes a specific user (admin only).
- **Headers**: `Authorization: Bearer <token>`
- **Request Parameters**: `id`: The ID of the user.
- **Response (Success - 200)**: 
  ```json
  {
    "message": "User deleted successfully"
  }

- **Response (Error - 404, if user not found)**: 
  ```json
  {
    "statusCode": 404,
    "message": "User not found",
    "error": "Not Found"
  }

### 26. Reset User Password (Admin)
- **Endpoint**: `POST /api/admin/users/:id/reset-password`
- **Description**: Resets the password for a specific user (admin only).
- **Headers**: `Authorization: Bearer <token>`
- **Request Parameters**: `id`: The ID of the user.
- **Request Body**: 
  ```json
  {
    "newPassword": "newpassword123"
  }

- **Response (Success - 200)**:
  ```json
  {
    "message": "Password reset successful"
  }

- **Response (Error - 404, if user not found)**:
  ```json
  {
    "statusCode": 404,
    "message": "User not found",
    "error": "Not Found"
  }

- **Response (Error - 401, if token is invalid or user is not an admin)**:
  ```json
  {
    "statusCode": 401,
    "message": "Invalid token",
    "error": "Unauthorized"
  }

### 27. Get All Job Posts (Admin)
- **Endpoint**: `GET /api/admin/job-posts`
- **Description**: Retrieves all job posts with optional filters by status, pending review status, title (partial match), employer_id, category_id, id, and pagination (admin only). Returns total count and paginated data.
- **Headers**: `Authorization: Bearer <token>`
- **Query Parameters**:
  - `status` (string, optional): Filter by status ("Active", "Draft", "Closed").
  - `pendingReview` (string, optional): Filter by pending review status ("true" or "false").
  - `title` (string, optional): Filter by job title (partial match, case-insensitive).
  - `employer_id` (string, optional): Filter by employer ID.
  - `category_id` - deprecated (одна категория, сохраняется)
  - `category_ids` — NEW (array или comma-list), примеры: ?category_ids[]=<id1>&category_ids[]=<id2>  ?category_ids=<id1>,<id2>
  - `employer_username` (string, optional): Filter by employer username (partial match, case-insensitive).
  - `id` (string, optional): Filter by job post ID.
  - `page` (number, optional): Page number for pagination (default: 1).
  - `limit` (number, optional): Number of items per page (default: 10).
- **Example Request**: `/api/admin/job-posts?status=Active&pendingReview=false&title=Software&employer_id=<employerId>&employer_username=john&page=1&limit=10`
- **Response (Success - 200)**: 
  ```json
  {
    "total": 2,
    "data": [
      {
        "id": "<jobPostId>",
        "title": "Software Engineer",
        "description": "Develop and maintain web applications.",
        "location": "Remote",
        "salary": null,
        "status": "Active",
        "job_type": "Full-time",
        "salary_type": "negotiable",
        "excluded_locations": [],
        "pending_review": false,

        "category_id": "<catId1>",                    // legacy
        "category": { "id": "<catId1>", "name": "Development" },
        "category_ids": ["<catId1>", "<catId2>"],     // NEW
        "categories": [
          { "id": "<catId1>", "name": "Development" },
          { "id": "<catId2>", "name": "Writing" }
        ],

        "employer_id": "<userId>",
        "employer": {
          "id": "<userId>",
          "email": "employer100@example.com",
          "username": "jane_smith100",
          "role": "employer"
        },
        "views": 10,
        "slug": "software-engineer-remote",
        "slug_id": "software-engineer-remote--8df3b0be",
        "created_at": "2025-07-08T07:00:00.000Z",
        "updated_at": "2025-07-08T07:00:00.000Z",

        "emailStats": { "sent": 20, "opened": 7, "clicked": 3 }
      }
    ]
  }

- **Response (Error - 400, pagination parametrs incorrect)**:
  ```json
  {
    "statusCode": 400,
    "message": "Page must be a positive integer",
    "error": "Bad Request"
  }

- **Response (Error - 401, if token is invalid or user is not an admin)**:
  ```json
  {
    "statusCode": 401,
    "message": "Invalid token",
    "error": "Unauthorized"
  }

### 28. Update Job Post (Admin)
- **Endpoint**: `PUT /api/admin/job-posts/:id`
- **Description**: Updates a specific job post (admin only).
- **Headers**: `Authorization: Bearer <token>`
- **Request Parameters**: `id`: The ID of the job post.
- **Request Body**:
  ```json
  {
    "title": "Senior Software Engineer",
    "description": "Updated description...",
    "location": "Remote",
    "salary": 60000,
    "status": "Closed",
    "job_type": "Full-time",
    "salary_type": "per month",
    "excluded_locations": ["Country1"],
    "category_ids": ["<catId1>", "<catId2>"],  // NEW
    "category_id": "<catId1>"                  // deprecated
  }

- **Response (Success - 200)**: 
  ```json
  {
    "id": "<jobPostId>",
    "title": "Senior Software Engineer",
    "description": "Updated description...",
    "location": "Remote",
    "salary": 60000,
    "status": "Closed",
    "job_type": "Full-time",
    "salary_type": "per month",
    "excluded_locations": ["Country1"],
    "pending_review": false,
  
    "category_id": "<categoryId>",                    // legacy
    "category": { "id": "<categoryId>", "name": "Software Development" },
    "category_ids": ["<catId1>", "<catId2>"],         // NEW
    "categories": [
      { "id": "<catId1>", "name": "Software Development" },
      { "id": "<catId2>", "name": "DevOps" }
    ],
  
    "employer_id": "<userId>",
    "employer": {
      "id": "<userId>",
      "email": "test15@example.com",
      "username": "test15",
      "role": "employer"
    },
    "created_at": "2025-05-13T18:00:00.000Z",
    "updated_at": "2025-05-13T18:30:00.000Z"
  }

### 29. Delete Job Post (Admin)
- **Endpoint**: `DELETE /api/admin/job-posts/:id`
- **Description**: Deletes a specific job post (admin only).
- **Headers**: `Authorization: Bearer <token>`
- **Request Parameters**: `id`: The ID of the job post.
- **Response (Success - 200)**: 
  ```json
  {
    "message": "Job post deleted successfully"
  }

- **Response (Error - 404, if job post not found)**: 
  ```json
  {
    "statusCode": 404,
    "message": "Job post not found",
    "error": "Not Found"
  }

### 30. Approve Job Post (Admin)
- **Endpoint**: `POST /api/admin/job-posts/:id/approve`
- **Description**: Approves a job post by setting pending_review to false (admin only).
- **Headers**: `Authorization: Bearer <token>`
- **Request Parameters**: `id`: The ID of the job post.
- **Response (Success - 200)**: 
  ```json
  {
    "id": "<jobPostId>",
    "title": "Software Engineer",
    "description": "We are looking for a skilled software engineer...",
    "location": "Remote",
    "salary": 50000,
    "status": "Active",
    "pending_review": false,
    "category_id": "<categoryId>",
    "job_type": "Full-time",
    "employer_id": "<employerId>",
    "applicationLimit": 100,
    "created_at": "2025-05-15T06:12:00.000Z",
    "updated_at": "2025-05-15T06:12:00.000Z"
  }

- **Response (Error - 404, if job post not found)**: 
  ```json  
  {
    "statusCode": 404,
    "message": "Job post not found",
    "error": "Not Found"
  }

### 31. Flag Job Post for Review (Admin)
- **Endpoint**: `POST /api/admin/job-posts/:id/flag`
- **Description**: Flags a job post for review by setting pending_review to true (admin only).
- **Headers**: `Authorization: Bearer <token>`
- **Request Parameters**: `id`: The ID of the job post.
- **Response (Success - 200)**: 
  ```json
  {
    "id": "<jobPostId>",
    "title": "Software Engineer",
    "description": "We are looking for a skilled software engineer...",
    "location": "Remote",
    "salary": 50000,
    "status": "Active",
    "pending_review": true,
    "category_id": "<categoryId>",
    "job_type": "Full-time",
    "employer_id": "<employerId>",
    "applicationLimit": 100,
    "created_at": "2025-05-15T06:12:00.000Z",
    "updated_at": "2025-05-15T06:12:00.000Z"
  }

- **Response (Error - 404, if job post not found)**: 
  ```json  
  {
    "statusCode": 404,
    "message": "Job post not found",
    "error": "Not Found"
  }

- **Response (Error - 401, if unauthorized)**: 
  ```json  
  {
    "statusCode": 401,
    "message": "Only admins can access this resource",
    "error": "Unauthorized"
  }

### 32. Get All Reviews (Admin)
- **Endpoint**: `GET /api/admin/reviews`
- **Description**: Retrieves all reviews (admin only).
- **Headers**: `Authorization: Bearer <token>`
- **Response (Success - 200)**: 
  ```json
  [
  {
    "id": "<reviewId>",
    "reviewer_id": "<userId>",
    "reviewed_id": "<userId>",
    "job_application_id": "<jobApplicationId>",
    "rating": 4,
    "comment": "Great work, very professional!",
    "reviewer": {
      "id": "<userId>",
      "email": "employer4@example.com",
      "username": "employer4",
      "role": "employer"
    },
    "reviewed": {
      "id": "<userId>",
      "email": "jobseeker1@example.com",
      "username": "jobseeker1",
      "role": "jobseeker"
    },
    "job_application": {
      "id": "<jobApplicationId>",
      "job_post_id": "<jobPostId>",
      "job_seeker_id": "<userId>",
      "status": "Accepted"
    },
    "created_at": "2025-05-13T18:00:00.000Z",
    "updated_at": "2025-05-13T18:00:00.000Z"
  }
  ]

### 33. Delete Review (Admin)
- **Endpoint**: `DELETE /api/admin/reviews/:id`
- **Description**: Deletes a specific review (admin only).
- **Headers**: `Authorization: Bearer <token>`
- **Request Parameters**: `id`: The ID of the review.
- **Response (Success - 200)**: 
  ```json
  {
    "message": "Review deleted successfully"
  }

- **Response (Error - 404, if review not found)**: 
  ```json
  {
    "statusCode": 404,
    "message": "Review not found",
    "error": "Not Found"
  }

### 34. Get Analytics (Admin)
- **Endpoint**: `GET /api/admin/analytics`
- **Description**: Retrieves platform analytics including total users, employers, job seekers, job posts, active job posts, applications, and reviews (admin only).
- **Headers**: `Authorization: Bearer <token>`
- **Response (Success - 200)**: 
  ```json
  {
    "totalUsers": 100,
    "employers": 20,
    "jobSeekers": 80,
    "totalJobPosts": 50,
    "activeJobPosts": 30,
    "totalApplications": 200,
    "totalReviews": 50
  }

- **Response (Error - 401, if token is invalid or user is not an admin)**: 
  ```json
  {
    "statusCode": 401,
    "message": "Invalid token",
    "error": "Unauthorized"
  }

### 35. Get Registration Stats (Admin)
- **Endpoint**: `GET /api/admin/analytics/registrations`
- **Description**: Retrieves registration statistics over a specified period, optionally filtered by user role (admin only).
- **Headers**: `Authorization: Bearer <token>`
- **Query Parameters**: 
  - `startDate` (string, required): Start date in format `YYYY-MM-DD`.
  - `endDate` (string, required): End date in format `YYYY-MM-DD`.
  - `interval` (string, required): Interval for grouping ("day", "week", "month").
  - `role` (string, optional): Filter by user role ("jobseeker", "employer", "all"). Defaults to "all".
- **Example Request**: 
  - Without role filter: `/api/admin/analytics/registrations?startDate=2025-05-01&endDate=2025-05-15&interval=day`
  - With role filter: `/api/admin/analytics/registrations?startDate=2025-05-01&endDate=2025-05-15&interval=day&role=jobseeker`
- **Response (Success - 200)**: 
  ```json
  [
    {
      "period": "2025-05-01T00:00:00.000Z",
      "count": 5
    },
    {
      "period": "2025-05-02T00:00:00.000Z",
      "count": 3
    }
  ]

- **Response (Error - 400, if invalid dates)**:  
  ```json
  {
    "statusCode": 400,
    "message": "Invalid date format",
    "error": "Bad Request"
  }

### 36. Get Geographic Distribution (Admin)
- **Endpoint**: `GET /api/admin/analytics/geographic-distribution`
- **Description**: Retrieves geographic distribution of users by country, optionally filtered by role and date range (admin only).
- **Headers**: `Authorization: Bearer <token>`
- **Query Parameters**: 
  - `startDate` (string, optional): Filter users registered on or after this date (format: `YYYY-MM-DD`). If not provided, no lower bound is applied.
  - `endDate` (string, optional): Filter users created before this date (format: YYYY-MM-DD).
  - `role` (string, optional): Filter by role ("jobseeker", "employer", "all", default: "all").
- **Example Request**: `/api/admin/analytics/geographic-distribution?startDate=2025-07-01&endDate=2025-07-31&role=jobseeker`
- **Response (Success - 200)**:
  ```json
  [
    {
      "country": "US",
      "count": 50
    },
    {
      "country": "CA",
      "count": 20
    }
  ]
- **Response (Error - 401, if token is invalid or user is not an admin)**:
  ```json
  {
    "statusCode": 401,
    "message": "Invalid token",
    "error": "Unauthorized"
  }
- **Response (Error - 400, if date format is invalid)**:
  ```json
  {
    "statusCode": 400,
    "message": "Invalid date format",
    "error": "Bad Request"
  }

### 35. Set Global Application Limit for All Job Posts (Admin)
- **Endpoint**: `POST /api/admin/settings/job-posts-application-limit`
- **Description**: Sets the global application limit for all job posts (admin only).
- **Headers**: `Authorization: Bearer <token>`
- **Request Body**:
  ```json
  {
    "limit": 50
  }
- **Response (Success - 200)**: 
  ```json
  {
    "message": "Application limit updated successfully",
    "limit": 50
  }

- **Response (Error - 400, if limit exceeds global limit)**: 
  ```json
  {
    "statusCode": 400,
    "message": "Application limit cannot exceed global limit of 1000",
    "error": "Bad Request"
  }

- **Response (Error - 404, if job post not found)**: 
  ```json
  {
    "statusCode": 404,
    "message": "Job post not found",
    "error": "Not Found"
  }

### 36. Submit Tech Issue Feedback
- **Endpoint**: `POST /api/feedback`
- **Description**: Allows authenticated jobseekers or employers to submit general feedback about the platform.
- **Headers**: `Authorization: Bearer <token>`
- **Request Body**:
  ```json
  {
    "category": "Bug", // One of: Bug | UI | Perfomance | Data | Other
    "summary": "Short 1–2 sentence description",
    "steps_to_reproduce": "1) Open ... 2) Click ... 3) Error",
    "expected_result": "Should open profile page",
    "actual_result": "Stays on the same page with 500"
  }

- **Response (Success - 200)**: 
  ```json
  {
    "id": "<feedbackId>",
    "user_id": "<userId>",
    "role": "jobseeker",
    "category": "Bug",
    "summary": "Short 1–2 sentence description",
    "steps_to_reproduce": "1) Open ... 2) Click ... 3) Error",
    "expected_result": "Should open profile page",
    "actual_result": "Stays on the same page with 500",
    "created_at": "2025-08-15T10:00:00.000Z",
    "updated_at": "2025-08-15T10:00:00.000Z"
  }

- **Response (Error - 401, if token invalid or user not jobseeker/employer)**: 
  ```json
  {
    "statusCode": 401,
    "message": "Only jobseekers and employers can submit feedback",
    "error": "Unauthorized"
  }

### 37. Get Tech Issue Feedback (Admin)
- **Endpoint**: `GET /api/feedback`
- **Description**: Retrieves all general feedback submissions (admin only).
- **Headers**: `Authorization: Bearer <token>`
- **Response (Success - 200)**: 
  ```json
  [
    {
      "id": "<feedbackId>",
      "user_id": "<userId>",
      "role": "employer",
      "category": "UI",
      "summary": "Button misaligned on mobile",
      "steps_to_reproduce": "Open /jobs on iPhone SE...",
      "expected_result": "Buttons aligned in a row",
      "actual_result": "Buttons wrap to next line",
      "created_at": "2025-08-15T10:00:00.000Z",
      "updated_at": "2025-08-15T10:00:00.000Z",
      "user": {
        "id": "<userId>",
        "username": "employer1",
        "email": "employer@example.com"
      }
    }
  ]

- **Response (Error - 401, if user is not an admin)**:   
  ```json
  {
  "statusCode": 401,
  "message": "Only admins can view feedback",
  "error": "Unauthorized"
  }

### 38. Add Blocked Country (Admin)
- **Endpoint**: `POST /api/admin/blocked-countries`
- **Description**: Adds a country to the blocked list (admin only).
- **Headers**: `Authorization: Bearer <token>`
- **Request Body**: 
  ```json
  {
    "countryCode": "IN"
  }
- **Response (Success - 201)**:
  ```json
  {
    "id": "<blockedCountryId>",
    "country_code": "IN",
    "created_at": "2025-05-15T06:12:00.000Z",
    "updated_at": "2025-05-15T06:12:00.000Z"
  }

- **Response (Error - 400, if country is already blocked)**:
  ```json
  {
    "statusCode": 400,
    "message": "Country is already blocked",
    "error": "Bad Request"
  }

### 39. Remove Blocked Country (Admin)
- **Endpoint**: `DELETE /api/admin/blocked-countries/:countryCode`
- **Description**: Removes a country from the blocked list (admin only).
- **Headers**: `Authorization: Bearer <token>`
- **Request Parameters**: `countryCode`: The country code to remove (e.g., "IN").
- **Response (Success - 200)**: 
  ```json
  {
    "message": "Country removed from blocked list"
  }
- **Response (Error - 400, if country is not blocked)**:
  ```json
  {
    "statusCode": 400,
    "message": "Country is not blocked",
    "error": "Bad Request"
  }

### 40. Get Blocked Countries (Admin)
- **Endpoint**: `GET /api/admin/blocked-countries`
- **Description**: Retrieves the list of blocked countries (admin only).
- **Headers**: `Authorization: Bearer <token>`
- **Response (Success - 200)**: 
  ```json
  [
  {
    "id": "<blockedCountryId>",
    "country_code": "IN",
    "created_at": "2025-05-15T06:12:00.000Z",
    "updated_at": "2025-05-15T06:12:00.000Z"
  },
  {
    "id": "<blockedCountryId>",
    "country_code": "PK",
    "created_at": "2025-05-15T06:12:00.000Z",
    "updated_at": "2025-05-15T06:12:00.000Z"
  }
  ]

### 41. Get Top Employers (Admin)
- **Endpoint**: `GET /api/admin/leaderboards/top-employers`
- **Description**: Retrieves the top employers by average rating (admin only).
- **Headers**: `Authorization: Bearer <token>`
- **Query Parameters**: 
  - `limit` (number, optional): Number of results to return (default: 10).
- **Response (Success - 200)**:   
  ```json
  [
    {
      "userId": "<employerId>",
      "username": "jane_smith113",
      "email": "jane@example.com",
      "averageRating": 4.5
    }
  ]

- **Response (Error - 401, if user is not an admin)**:   
  ```json
  {
    "statusCode": 401,
    "message": "Unauthorized",
    "error": "Unauthorized"
  }

### 42. Get Top Jobseekers (Admin)
- **Endpoint**: `GET /api/admin/leaderboards/top-jobseekers`
- **Description**: Retrieves the top jobseekers by the number of applications (admin only).
- **Headers**: `Authorization: Bearer <token>`
- **Query Parameters**: 
  - `limit` (number, optional): Number of results to return (default: 10).
- **Response (Success - 200)**:   
  ```json
  [
    {
      "userId": "<jobseekerId>",
      "username": "john_doe",
      "email": "john@example.com",
      "averageRating": 4
    }
  ]

- **Response (Error - 401, if user is not an admin)**:   
  ```json
  {
    "statusCode": 401,
    "message": "Unauthorized",
    "error": "Unauthorized"
  }  

### 43. Upload Avatar
- **Endpoint**: `POST /api/profile/upload-avatar`
- **Description**: Uploads an avatar image for the authenticated user from their device.
- **Headers**: `Authorization: Bearer <token>`
- **Request Body**: Form-data with a field `avatar` (file: JPEG, JPG, PNG, max 5MB)
- **Response (Success - 200)**: Returns the updated profile (same format as GET /api/profile)

- **Response (Error - 400, if file is missing or invalid)**
      ```json
  {
    "statusCode": 400,
    "message": "Only JPEG, JPG, and PNG files are allowed",
    "error": "Bad Request"
  }

### 44. Upload Identity Document
- **Endpoint**: `POST /api/profile/upload-identity`
- **Description**: Uploads an identity document for verification from the authenticated user’s device.
- **Headers**: `Authorization: Bearer <token>`
- **Request Body**: Form-data with a field document (file: JPEG, JPG, PNG, PDF, max 10MB)
- **Response (Success - 200)**: Returns the updated profile (same format as GET /api/profile)

- **Response (Error - 400, if file is missing or invalid)**
      ```json
  {
    "statusCode": 400,
    "message": "Only JPEG, JPG, PNG, and PDF files are allowed",
    "error": "Bad Request"
  }

### 44.1 Upload Resume
- **Endpoint**: `POST /api/profile/upload-resume`
- **Description**: Uploads a resume file for the authenticated jobseeker from their device.
- **Headers**: `Authorization: Bearer <token>`
- **Request Body**: Form-data with a field resume (file: PDF, DOC, DOCX, max 10MB)
- **Response (Success - 200)**: Returns the updated profile (same format as GET /api/profile)
- **Response (Error - 400, if file is missing or invalid)**
      ```json
  {
    "statusCode": 400,
    "message": "Only PDF, DOC, and DOCX files are allowed",
    "error": "Bad Request"
  }

### 45. Verify Identity (Admin)
- **Endpoint**: `POST /api/admin/profile/:id/verify-identity`
- **Description**: Verifies or rejects the identity of a user by setting the identity_verified field (admin only).
- **Headers**: `Authorization: Bearer <token>`
- **Request Parameters**: `id`: The ID of the user.
- **Request Body**:
  ```json
  {
    "verify": true
  }

- **Response (Success - 200)**: Returns the updated profile (same format as GET /api/profile)

- **Response (Error - 401, if token is invalid or user is not an admin)**:
  ```json
  {
    "statusCode": 401,
    "message": "Unauthorized",
    "error": "Unauthorized"
  }

- **Response (Error - 400, if verify parameter is invalid)**:
  ```json  
  {
    "statusCode": 400,
    "message": "Invalid 'verify' parameter (must be boolean)",
    "error": "Bad Request"
  }

- **Response (Error - 404, if user not found)**:
  ```json
  {
    "statusCode": 404,
    "message": "User not found",
    "error": "Not Found"
  }

- **Response (Error - 404, if no document uploaded)**:
  ```json
  {
    "statusCode": 404,
    "message": "No identity document uploaded",
    "error": "Not Found"
  } 

### 46. Set Global Application Limit (Admin)
- **Endpoint**: `POST /api/admin/settings/application-limit`
- **Description**: Sets the global application limit for all job posts (admin only). Note: There is a separate endpoint for applying the limit to existing job posts.
- **Headers**: `Authorization: Bearer <token>`
- **Request Body**:
  ```json
  {
    "limit": 1000
  }

- **Response (Success - 200)**:
  ```json
  {
    "message": "Global application limit updated successfully",
    "limit": 1000
  } 

- **Response (Error - 400, if limit is invalid)**:
  ```json
  {
    "statusCode": 400,
    "message": "Global application limit must be a non-negative number",
    "error": "Bad Request"
  }

- **Response (Error - 401, if user is not an admin)**:
  ```json
  {
    "statusCode": 401,
    "message": "Unauthorized",
    "error": "Unauthorized"
  }

### 47. Get Global Application Limit (Admin)
- **Endpoint**: `GET /api/admin/settings/application-limit`
- **Description**: Retrieves the global application limit (admin only).
- **Headers**: `Authorization: Bearer <token>`
- **Response (Success - 200)**:
  ```json
  {
    "globalApplicationLimit": 1000
  }

- **Response (Error - 401, if user is not an admin)**:
  ```json
  {
    "statusCode": 401,
    "message": "Unauthorized",
    "error": "Unauthorized"
  }

### 49. Increment Job Post Views
- **Endpoint**: `POST /api/job-posts/:id/increment-view`
- **Description**: Increments the view count for a specific job post.
- **Request Parameters**: `id`: The ID of the job post
- **Response (Success - 200)**:
  ```json
  {
    "message": "View count incremented",
    "views": 1
  }

- **Response (Error - 404, if job post not found)**:
  ```json
  {
    "statusCode": 404,
    "message": "Job post not found",
    "error": "Not Found"
  }

### 52. Block User (Admin)
- **Endpoint**: `POST /api/admin/users/:id/block`
- **Description**: Blocks a specific user (admin only).
- **Headers**: `Authorization: Bearer <token>`
- **Request Parameters**: `id`: The ID of the user.
- **Response (Success - 200)**:
  ```json
  {
    "message": "User blocked successfully"
  }

- **Response (Error - 404, if user not found)**:
  ```json
  {
    "statusCode": 404,
    "message": "User not found",
    "error": "Not Found"
  }

- **Response (Error - 400, if user already blocked)**:
  ```json
  {
    "statusCode": 400,
    "message": "User is already blocked",
    "error": "Bad Request"
  }

- **Response (Error - 401, if token is invalid or user is not an admin)**:
  ```json
  {
    "statusCode": 401,
    "message": "Invalid token",
    "error": "Unauthorized"
  }

### 53. Unblock User (Admin)
- **Endpoint**: `POST /api/admin/users/:id/unblock`
- **Description**: Unblocks a specific user (admin only).
- **Headers**: `Authorization: Bearer <token>`
- **Request Parameters**: `id`: The ID of the user.  
- **Response (Success - 200)**:
  ```json
  {
    "message": "User unblocked successfully"
  }

- **Response (Error - 404, if user not found)**:
  ```json
  {
    "statusCode": 404,
    "message": "User not found",
    "error": "Not Found"
  }

- **Response (Error - 400, if user already active)**:
  ```json
  {
    "statusCode": 400,
    "message": "User is already active",
    "error": "Bad Request"
  }

- **Response (Error - 401, if token is invalid or user is not an admin)**:
  ```json
  {
    "statusCode": 401,
    "message": "Invalid token",
    "error": "Unauthorized"
  }

### 54. Increment Profile Views
- **Endpoint**: `POST /api/profile/:id/increment-view`
- **Description**: Increments the view count for a specific jobseeker's profile.
- **Headers**: `Authorization: Bearer <token>`
- **Request Parameters**: `id`: The ID of the user (jobseeker).
- **Response (Success - 200)**:
  ```json
  {
    "message": "Profile view count incremented",
    "profile_views": 1
  }

- **Response (Error - 404, if user or profile not found)**:
  ```json
  {
    "statusCode": 404,
    "message": "User not found",
    "error": "Not Found"
  }

- **Response (Error - 400, if user is not a jobseeker)**:
  ```json
  {
    "statusCode": 400,
    "message": "Profile views can only be incremented for jobseekers",
    "error": "Bad Request"
  }

### 55. Get Top Jobseekers by Profile Views (Admin)
- **Endpoint**: `GET /api/admin/leaderboards/top-jobseekers-by-views`
- **Description**: Retrieves the top jobseekers by profile views (admin only).
- **Headers**: `Authorization: Bearer <token>`
- **Query Parameters**: `limit` (number, optional): Number of jobseekers to return (default: 10).
- **Response (Success - 200)**:
  ```json
  [
    {
      "userId": "<jobseekerId>",
      "username": "john_doe",
      "email": "john@example.com",
      "profileViews": 100
    }
  ]

- **Response (Error - 400, if limit is invalid)**:
  ```json
  {
    "statusCode": 400,
    "message": "Limit must be a positive integer",
    "error": "Bad Request"
  }

- **Response (Error - 401, if token is invalid or user is not an admin)**:
  ```json
  {
    "statusCode": 401,
    "message": "Invalid token",
    "error": "Unauthorized"
  }

### 56. Export Users to CSV (Admin)
- **Endpoint**: `GET /api/admin/users/export-csv`
- **Description**: Exports users to a CSV file. If no query parameters are provided, all users are exported (backward compatible).
- **Headers**: `Authorization: Bearer <token>`
- **Query Parameters (all optional)**:
  - `role`: (string): jobseeker | employer | admin | moderator. Filter by user role.
  - `status`: (string): active | blocked. Filter by account status.
  - `q`: (string): any. Substring search across email and username (case-insensitive).
  - `email`: (string): any. Case-insensitive match on email (ILIKE).
  - `username`: (string): any. Case-insensitive match on username (ILIKE).
  - `country`: (string): any or unknown. Match by country; unknown matches NULL.
  - `provider`: (string): any or none. Match by OAuth provider; none matches NULL.
  - `referralSource`: (string): any. Substring match on referral_source
  - `isEmailVerified`: (boolean): true | false. Filter by email verification flag.
  - `identityVerified`: (boolean): jtrue | false. Filter by identity verification flag.
  - `hasAvatar`: (boolean): true | false. Users with/non avatar.
  - `hasResume`: (boolean): true | false. For jobseekers: presence of resume.
  - `jobSearchStatus`: (string): actively_looking | open_to_offers | hired. Jobseeker status.
  - `companyName`: (string): any. Employer’s company name (substring).
  - `riskMin`: (number): integer/float. risk_score >= riskMin.
  - `riskMax`: (number): integer/float. risk_score <= riskMax.
  - `createdFrom`: (date): ISO (e.g., 2025-01-01). Registered on/after this date..
  - `createdTo`: (date): ISO. Registered on/before this date (inclusive).
  - `lastLoginFrom`: (date): ISO. Last login on/after this date.
  - `lastLoginToe`: (date): ISO. Last login on/before this date (inclusive).
  - `sortBy`: (string): created_at | last_login_at. Sort field. Default: created_at.
  - `order`: (string): ASC | DESC. Sort order. Default: DESC.
- **Notes**:
  - `createdTo` / `lastLoginTo` are treated as inclusive (end of day).
  - If role-specific columns don’t apply (e.g., employer fields for jobseekers), those CSV cells are left empty.
  - `provider=none` and `country=unknown` match `NULL` values.

- **Response (Success - 200)**:
  - Content-Type: `text/csv`
  - Content-Disposition: `attachment`; `filename="users_YYYYMMDD[_role-…].csv"`
- **CSV Columns**:
  - User ID,Email,Username,Role,Status,Country,Provider,Email Verified,Identity Verified,
    Referral Source,Risk Score,Created At,Updated At,Last Login At,Last Seen At,Has Avatar,
    JS Job Search Status,JS Expected Salary,JS Currency,JS Avg Rating,JS Has Resume,
    EM Company Name,EM Avg Rating



- **Response (Error - 401, if token is invalid or user is not an admin)**:  
    ```json
  {
    "statusCode": 401,
    "message": "Invalid token",
    "error": "Unauthorized"
  }

- **Response (Error - 400 Bad Request (invalid query values, e.g., malformed dates))**:  
    ```json
  {
    "statusCode": 400,
    "message": "Invalid query parameters",
    "error": "Bad Request"
  }  

### 57. Get Top Employers by Job Posts (Admin)
- **Endpoint**: `GET /api/admin/leaderboards/top-employers-by-posts`
- **Description**: Retrieves the top employers by the number of job posts created (admin only).
- **Headers**: `Authorization: Bearer <token>`
- **Query Parameters**: `limit` (number, optional): Number of results to return (default: 10).
- **Response (Success - 200)**:
  ```json
  [
    {
      "userId": "<employerId>",
      "username": "jane_smith",
      "email": "employer@example.com",
      "jobCount": 5
    }
  ]

- **Response (Error - 401, if token is invalid or user is not an admin)**:  
    ```json
  {
    "statusCode": 401,
    "message": "Invalid token",
    "error": "Unauthorized"
  }

### 58. Get Growth Trends (Admin)
- **Endpoint**: `GET /api/admin/analytics/growth-trends`
- **Description**: Retrieves growth trends for registrations and job posts over the last 7 or 30 days, grouped by day (admin only).
- **Headers**: `Authorization: Bearer <token>`
- **Query Parameters**: `period` (string, optional): Time period ("7d" or "30d", default: "7d").
- **Response (Success - 200)**:
  ```json
  {
    "registrations": [
      {
        "period": "2025-05-20T00:00:00.000Z",
        "count": 5
      },
      {
        "period": "2025-05-21T00:00:00.000Z",
        "count": 3
      }
    ],
    "jobPosts": [
      {
        "period": "2025-05-20T00:00:00.000Z",
        "count": 2
      },
      {
        "period": "2025-05-21T00:00:00.000Z",
        "count": 4
      }
    ]
  }

- **Response (Error - 401, if token is invalid or user is not an admin)**:  
    ```json
  {
    "statusCode": 401,
    "message": "Invalid token",
    "error": "Unauthorized"
  }  

### 59. Get Recent Registrations (Admin)
- **Endpoint**: `GET /api/admin/analytics/recent-registrations`
- **Description**: Returns registrations for a single day (jobseekers and employers), plus referral metadata. Admin only.
- **Headers**: `Authorization: Bearer <token>`
- **Query Parameters**: 
  - `date (string, optional)` — Day to fetch in `YYYY-MM-DD` (admin’s local date). If omitted, “today” is used based on `tzOffset`.
  - `tzOffset` (number, optional; default `0`) — Minutes east of UTC (e.g., UTC+3 → `180`, UTC−4 → `-240`). Used to compute the day window.
  - `limit` (number, optional; default `5`) — Max rows per role to return (useful for the dashboard table). Note: the response also includes totals.
- **Response (Success - 200)**:
  ```json
  {
    "date": "2025-09-15",
    "tzOffset": 180,
    "jobseekers_total": 3,
    "employers_total": 1,
    "jobseekers": [
      {
        "id": "<userId>",
        "email": "jobseeker@example.com",
        "username": "john_doe",
        "role": "jobseeker",
        "created_at": "2025-09-15T06:00:00.000Z",

        "referral_from_signup": "facebook_ads_campaign_12",
        "referral_link_description": "Promo link for Data Analyst opening",
        "referral_job": { "id": "<jobPostId>", "title": "Data Analyst (Remote)" },
        "referral_job_description": "We are looking for a data analyst to ..."
      }
    ],
    "employers": [
      {
        "id": "<userId>",
        "email": "employer@example.com",
        "username": "jane_smith",
        "role": "employer",
        "created_at": "2025-09-15T05:21:00.000Z",

        "referral_from_signup": null,
        "referral_link_description": null,
        "referral_job": null,
        "referral_job_description": null
      }
    ]
  }

- **Response (Error - 401, if token is invalid or user is not an admin)**:  
    ```json
  {
    "statusCode": 401,
    "message": "Invalid token",
    "error": "Unauthorized"
  }    

### 59.1. Get user registrations breakdown by site brand (Admin)
- **Endpoint**: `GET /api/admin/analytics/brands`
- **Description**: Return user registrations breakdown by site brand (multi-site), with counts for Total, Employers, and Jobseekers per brand.
- **Headers**: `Authorization: Bearer <token>`
- **Query Parameters**: 
  - `startDate` (optional) — ISO date, e.g. 2025-10-01.
  - `endDate` (optional) — ISO date, e.g. 2025-10-31 (inclusive; calculated up to 23:59:59.999)
- **Response (Success - 200)**:
  ```json
  {
    "range": {
      "startDate": "2025-10-01",
      "endDate": "2025-10-31"
    },
    "byBrand": [
      { "brand": "jobforge",  "total": 123, "employers": 45, "jobseekers": 78 },
      { "brand": "22resumes", "total": 50,  "employers": 10, "jobseekers": 40 },
      { "brand": "unknown",   "total": 5,   "employers": 1,  "jobseekers": 4 }
    ],
    "overall": { "total": 178, "employers": 56, "jobseekers": 122 }
  }

### 60. Get Job Posts with Applications (Admin)
- **Endpoint**: `GET /api/admin/job-posts/applications`
- **Description**: Retrieves job posts with their application counts and employer details, optionally filtered by status (admin only).
- **Headers**: `Authorization: Bearer <token>`
- **Query Parameters**: 
  - `limit` (number, optional): Number of results to return (default: 5).
  - `status` (string, optional): Filter by job post status ("Active", "Draft", "Closed").
- **Response (Success - 200)**:
  ```json
  [
    {
      "id": "<jobPostId>",
      "title": "Software Engineer",
      "status": "Active",
      "applicationCount": 10,
      "created_at": "2025-05-27T06:00:00.000Z",
      "employer": {
        "id": "<userId>",
        "username": "john_doe",
        "company_name": "Tech Corp"
      }
    }
  ]

- **Response (Error - 401, if token is invalid or user is not an admin)**:  
    ```json
  {
    "statusCode": 401,
    "message": "Invalid token",
    "error": "Unauthorized"
  }

### 61. Get Online Users (Admin)
- **Endpoint**: `GET /api/admin/analytics/online-users`
- **Description**: Retrieves the count of online jobseekers and employers (admin only).
- **Headers**: `Authorization: Bearer <token>`
- **Response (Success - 200)**:
  ```json
  {
    "jobseekers": 15,
    "employers": 5
  }

- **Response (Error - 401, if token is invalid or user is not an admin)**:  
    ```json
  {
    "statusCode": 401,
    "message": "Invalid token",
    "error": "Unauthorized"
  }

### 62. Get User Online Status
- **Endpoint**: `GET /api/users/:id/online`
- **Description**: Checks if a specific user is online, based on their presence in the Redis store. Accessible to jobseekers, employers, admins, and moderators.
- **Headers**: `Authorization: Bearer <token>`
- **Request Parameters**: `id`: The ID of the user.
- **Response (Success - 200)**:
  ```json
  {
    "userId": "<userId>",
    "isOnline": true,
    "role": "jobseeker" // or "employer", "admin", "moderator"
  }
- **Response (Error - 401, if token is invalid)**:
  ```json
  {
    "statusCode": 401,
    "message": "Invalid token",
    "error": "Unauthorized"
  }
- **Response (Error - 401, if user role is not supported)**:
  ```json
  {
    "statusCode": 401,
    "message": "Only jobseekers, employers, admins, or moderators can check online status",
    "error": "Unauthorized"
  }
- **Response (Error - 404, if user not found)**:
  ```json
  {
    "statusCode": 404,
    "message": "User not found",
    "error": "Not Found"
  }

### 63. Get User Risk Score (Admin)
- **Endpoint**: `GET /api/admin/users/:id/risk-score`
- **Description**: Retrieves the risk score and fraud details for a specific user (admin only).
- **Headers**: `Authorization: Bearer <token>`
- **Request Parameters**: `id`: The ID of the user.
- **Response (Success - 200)**:
  ```json
  {
    "userId": "<userId>",
    "riskScore": 50,
    "details": {
      "duplicateIp": true,
      "proxyDetected": false,
      "duplicateFingerprint": false
    }
  }

- **Response (Error - 404, if user not found)**:  
    ```json
  {
    "statusCode": 404,
    "message": "User not found",
    "error": "Not Found"
  }

- **Response (Error - 401, if token is invalid or user is not an admin)**:  
    ```json
  {
    "statusCode": 401,
    "message": "Invalid token",
    "error": "Unauthorized"
  }

### 64. Search Talents
- **Endpoint**: `GET /api/talents`
- **Description**: Retrieves a list of freelancers based on specified filters such as skills, experience, description, rating, and timezone, with pagination and sorting options.
- **Request Parameters**:
  - `skills` (string or string[], optional): Filter by skills (e.g., "skills=Python" or "skills[]=Python&skills[]=JavaScript").
  - `experience` (string, optional): Filter by experience (partial match, e.g., "3 years").
  - `description` (string, optional): Filter by description (partial match, e.g., "React developer").
  - `rating` (number, optional): Filter by minimum average rating (0 to 5, e.g., "4").
  - `timezone` (string, optional): Filter by timezone (e.g., "America/New_York").
  - `page` (number, optional): Page number for pagination (default: 1).
  - `limit` (number, optional): Number of items per page (default: 10).
  - `sort_by` (string, optional): Field to sort by ("average_rating" or "profile_views", default: "average_rating").
  - `sort_order` (string, optional): Sort order ("ASC" or "DESC", default: "DESC").
  - `job_search_status` — "actively_looking" | "open_to_offers" | "hired"
  - `expected_salary_min` — неотрицательное число.
  - `expected_salary_max` — неотрицательное число.
- **Example Request**: `/api/talents?skills=<skillId>&experience=3 years&description=React&rating=4&timezone=America/New_York&page=1&limit=10&sort_by=average_rating&sort_order=DESC`
- **Response (Success - 200)**:
  ```json
  {
    "total": 50,
    "data": [
      {
        "id": "<userId>",
        "username": "john_doe",
        "email": "john@example.com",
        "skills": [
          {
            "id": "<skillId>",
            "name": "Web Development",
            "parent_id": "<parentSkillId>"
          }
        ],
        "experience": "3 years",
        "description": "Experienced web developer specializing in React and Node.js",
        "portfolio": "https://portfolio.com",
        "video_intro": "https://video.com",
        "timezone": "America/New_York",
        "currency": "USD",
        "expected_salary": 3500.00,
        "average_rating": 4.5,
        "job_search_status": "open_to_offers",
        "profile_views": 100,
        "identity_verified": true,
        "avatar": "/uploads/avatars/<filename>"
      }
    ]
  }

- **Response (Error - 400, if invalid parameters)**:
  ```json
  {
    "statusCode": 400,
    "message": "Rating must be between 0 and 5",
    "error": "Bad Request"
  }

### 65. Submit Complaint
- **Endpoint**: `POST /api/complaints`
- **Description**: Allows authenticated jobseekers or employers to submit a complaint against a job post or another user's profile.
- **Headers**: `Authorization: Bearer <token>`
- **Request Body**:
  ```json
  {
    "job_post_id": "<jobPostId>", // Optional, if complaining about a job post
    "profile_id": "<userId>", // Optional, if complaining about a profile
    "reason": "Inappropriate content in the job description"
  }

- **Response (Success - 200)**:
  ```json
  {
    "id": "<complaintId>",
    "complainant_id": "<userId>",
    "job_post_id": "<jobPostId>",
    "profile_id": null,
    "reason": "Inappropriate content in the job description",
    "status": "Pending",
    "created_at": "2025-06-06T12:00:00.000Z",
    "updated_at": "2025-06-06T12:00:00.000Z"
  }

- **Response (Error - 400, if both or neither IDs provided)**:
  ```json
  {
    "statusCode": 400,
    "message": "Either job_post_id or profile_id must be provided",
    "error": "Bad Request"
  }

- **Response (Error - 400, if complaining about own profile)**:
  ```json
  {
    "statusCode": 400,
    "message": "Cannot submit a complaint against your own profile",
    "error": "Bad Request"
  }  

- **Response (Error - 400, if complaint already exists)**:
  ```json
  {
    "statusCode": 400,
    "message": "You have already submitted a pending complaint for this target",
    "error": "Bad Request"
  }    

- **Response (Error - 401, if token invalid)**:
  ```json
  {
    "statusCode": 401,
    "message": "Invalid token",
    "error": "Unauthorized"
  }

- **Response (Error - 404, if target not found)**:
  ```json
  {
    "statusCode": 404,
    "message": "Job post not found",
    "error": "Not Found"
  }

### 66. Get All Complaints (Admin)
- **Endpoint**: `GET /api/admin/complaints`
- **Description**: Retrieves all complaints for admin review.
- **Headers**: `Authorization: Bearer <token>`
- **Response (Success - 200)**:
  ```json
  [
    {
      "id": "<complaintId>",
      "complainant_id": "<userId>",
      "complainant": { "id": "<userId>", "username": "user1", "email": "user1@example.com" },
      "job_post_id": "<jobPostId>",
      "job_post": { "id": "<jobPostId>", "title": "Software Engineer" },
      "profile_id": null,
      "profile": null,
      "reason": "Inappropriate job description",
      "status": "Resolved",
      "resolution_comment": "Issue addressed",
      "resolver_id": "<adminId>",  
      "resolver": {  
        "id": "<adminId>",
        "username": "admin1",
        "email": "admin1@example.com",
        "role": "admin"
      },
      "created_at": "2025-07-31T12:00:00Z",
      "updated_at": "2025-07-31T12:10:00Z"
    }
  ]

- **Response (Error - 401, if not admin)**:
  ```json
  {
    "statusCode": 401,
    "message": "Only admins can view complaints",
    "error": "Unauthorized"
  }

### 67. Resolve Complaint (Admin)
- **Endpoint**: `POST /api/admin/complaints/:id/resolve`
- **Description**: Allows admins to resolve or reject a complaint with an optional comment.
- **Headers**: `Authorization: Bearer <token>`
- **Request Parameters**: `id`: The ID of the complaint.
- **Request Body**:
  ```json
  {
    "status": "Resolved",
    "comment": "Issue addressed with the user"
  }

- **Response (Success - 200)**:
  ```json
  {
    "id": "<complaintId>",
    "complainant_id": "<userId>",
    "job_post_id": "<jobPostId>",
    "profile_id": null,
    "reason": "Inappropriate job description",
    "status": "Resolved",
    "resolution_comment": "Issue addressed",
    "resolver_id": "<adminId>",  
    "resolver": {  
      "id": "<adminId>",
      "username": "admin1",
      "email": "admin1@example.com",
      "role": "admin"
    },
    "created_at": "2025-07-31T12:00:00Z",
    "updated_at": "2025-07-31T12:10:00Z"
  }

- **Response (Error - 401, if not admin)**:
  ```json
  {
    "statusCode": 401,
    "message": "Only admins can resolve complaints",
    "error": "Unauthorized"
  }

- **Response (Error - 404, if complaint not found)**:
  ```json
  {
    "statusCode": 404,
    "message": "Complaint not found",
    "error": "Not Found"
  }

### 68. Get Public Statistics
- **Endpoint**: `GET /api/stats`
- **Description**: Retrieves public statistics about the platform, including the total number of resumes (jobseeker profiles), job posts, and employers. Accessible to both authenticated and unauthenticated users.
- **Headers**: None (optional `Authorization: Bearer <token>` for authenticated users, but not required)
- **Request Parameters**: None
- **Response (Success - 200)**:
  ```json
  {
    "totalResumes": 150,
    "totalJobPosts": 300,
    "totalEmployers": 50
  }

### 68. Approve Job Post (Moderator)
- **Endpoint**: `POST api/moderator/job-posts/:id/approve`
- **Description**: Approves a job post by setting pending_review to false (moderator or admin only).
- **Headers**: `Authorization: Bearer <token>`
- **Request Parameters**: `id`: The ID of the job post.
- **Response (Success - 200)**:
  ```json
  {
    "id": "<jobPostId>",
    "title": "Software Engineer",
    "description": "We are looking for a skilled software engineer...",
    "location": "Remote",
    "salary": 50000,
    "status": "Active",
    "pending_review": false,
    "category_id": "<categoryId>",
    "job_type": "Full-time",
    "employer_id": "<employerId>",
    "applicationLimit": 100,
    "created_at": "2025-06-15T06:00:00.000Z",
    "updated_at": "2025-06-15T06:00:00.000Z"
  }

- **Response (Error - 404, if job post not found)**:
  ```json
  {
    "statusCode": 404,
    "message": "Job post not found",
    "error": "Not Found"
  }

- **Response (Error - 401, if not authorized)**:
  ```json
  {
    "statusCode": 401,
    "message": "Only moderators or admins can access this resource",
    "error": "Unauthorized"
  }

### 69. Flag Job Post (Moderator)
- **Endpoint**: `POST api/moderator/job-posts/:id/flag`
- **Description**: Flags a job post for review by setting pending_review to true (moderator or admin only).
- **Headers**: `Authorization: Bearer <token>`
- **Request Parameters**: `id`: The ID of the job post.
- **Response (Success - 200)**:
  ```json
  {
    "id": "<jobPostId>",
    "title": "Software Engineer",
    "description": "We are looking for a skilled software engineer...",
    "location": "Remote",
    "status": "Active",
    "pending_review": true,
    "category_id": "<categoryId>",
    "job_type": "Full-time",
    "employer_id": "<employerId>",
    "applicationLimit": 100,
    "created_at": "2025-06-15T06:00:00.000Z",
    "updated_at": "2025-06-15T06:00:00.000Z"
  }

- **Response (Error - 404, if job post not found)**:
  ```json
  {
    "statusCode": 404,
    "message": "Job post not found",
    "error": "Not Found"
  }

- **Response (Error - 404, if job post not found)**:
  ```json
  {
    "statusCode": 401,
    "message": "Only moderators or admins can access this resource",
    "error": "Unauthorized"
  }

### 70. Get All Reviews (Moderator)
- **Endpoint**: `GET api/moderator/reviews`
- **Description**: Retrieves all reviews (moderator or admin only).
- **Headers**: `Authorization: Bearer <token>`
- **Response (Success - 200)**:
  ```json
  [
    {
      "id": "<reviewId>",
      "reviewer_id": "<userId>",
      "reviewed_id": "<userId>",
      "job_application_id": "<jobApplicationId>",
      "rating": 4,
      "comment": "Great work, very professional!",
      "reviewer": {
        "id": "<userId>",
        "email": "employer4@example.com",
        "username": "employer4",
        "role": "employer"
      },
      "reviewed": {
        "id": "<userId>",
        "email": "jobseeker1@example.com",
        "username": "jobseeker1",
        "role": "jobseeker"
      },
      "job_application": {
        "id": "<jobApplicationId>",
        "job_post_id": "<jobPostId>",
        "job_seeker_id": "<userId>",
        "status": "Accepted"
      },
      "created_at": "2025-06-13T18:00:00.000Z",
      "updated_at": "2025-06-13T18:00:00.000Z"
    }
  ]

- **Response (Error - 401, if not authorized)**:
  ```json
  {
    "statusCode": 401,
    "message": "Only moderators or admins can access this resource",
    "error": "Unauthorized"
  }

### 71. Delete Review (Moderator)
- **Endpoint**: `DELETE api/moderator/reviews/:id`
- **Description**: Deletes a specific review (moderator or admin only).
- **Headers**: `Authorization: Bearer <token>`
- **Request Parameters**: `id`: The ID of the review.
- **Response (Success - 200)**:
  ```json
  {
    "message": "Review deleted successfully"
  }

- **Response (Error - 404, if review not found)**:
  ```json
  {
    "statusCode": 404,
    "message": "Review not found",
    "error": "Not Found"
  }

- **Response (Error - 401, if not authorized)**:
  ```json
  {
    "statusCode": 401,
    "message": "Only moderators or admins can access this resource",
    "error": "Unauthorized"
  }

### 72. Get All Complaints (Moderator)
- **Endpoint**: `GET api/moderator/complaints`
- **Description**: Retrieves all complaints for moderator review.
- **Headers**: `Authorization: Bearer <token>`
- **Response (Success - 200)**:
  ```json
  [
    {
      "id": "<complaintId>",
      "complainant_id": "<userId>",
      "complainant": {
        "id": "<userId>",
        "username": "john_doe",
        "email": "john@example.com",
        "role": "jobseeker"
      },
      "job_post_id": "<jobPostId>",
      "job_post": {
        "id": "<jobPostId>",
        "title": "Software Engineer",
        "description": "Looking for a skilled engineer"
      },
      "profile_id": null,
      "reason": "Inappropriate content in the job description",
      "status": "Pending",
      "created_at": "2025-06-06T12:00:00.000Z",
      "updated_at": "2025-06-06T12:00:00.000Z"
    }
  ]

- **Response (Error - 401, if not authorized)**:
  ```json
  {
    "statusCode": 401,
    "message": "Only moderators or admins can access this resource",
    "error": "Unauthorized"
  }

### 73. Resolve Complaint (Moderator)
- **Endpoint**: `POST api/moderator/complaints/:id/resolve`
- **Description**: Allows moderators to resolve or reject a complaint with an optional comment.
- **Headers**: `Authorization: Bearer <token>`
- **Request Parameters**: `id`: The ID of the complaint.
- **Request Body**:
  ```json
  {
    "status": "Resolved",
    "comment": "Issue addressed with the user"
  }

- **Response (Success - 200)**:
  ```json
  {
    "id": "<complaintId>",
    "complainant_id": "<userId>",
    "job_post_id": "<jobPostId>",
    "profile_id": null,
    "reason": "Inappropriate content in the job description",
    "status": "Resolved",
    "resolution_comment": "Issue addressed with the user",
    "created_at": "2025-06-06T12:00:00.000Z",
    "updated_at": "2025-06-06T12:30:00.000Z"
  }

- **Response (Error - 401, if not authorized)**:
  ```json
  {
    "statusCode": 401,
    "message": "Only moderators or admins can access this resource",
    "error": "Unauthorized"
  }

- **Response (Error - 404, if complaint not found)**:
  ```json
  {
    "statusCode": 404,
    "message": "Complaint not found",
    "error": "Not Found"
  }

### 74. Notify Job Seekers (Admin)
- **Endpoint**: `POST /api/admin/job-posts/:id/notify-candidates`
- **Description**: Sends email notifications to job seekers whose selected categories match the category of the specified job post. Allows selecting the number of recipients and the order of selection based on signup date.
- **Headers**: `Authorization: Bearer <token>`
- **Request Parameters**: `id`: The ID of the job post
- **Request Body**:
  ```json
  {
    "limit": 50,
    "orderBy": "end" // Options: "beginning", "end", "random"
  }

- **Response (Success - 200)**:
  ```json
  {
    "total": 120,
    "sent": 50,
    "jobPostId": "<jobPostId>"
  }

- **Response (Error - 400, invalid input)**:
  ```json
  {
    "statusCode": 400,
    "message": "Limit must be a positive integer",
    "error": "Bad Request"
  }

- **Response (Error - 400, no category)**:
  ```json
  {
    "statusCode": 400,
    "message": "Job post has no category assigned",
    "error": "Bad Request"
  }

- **Response (Error - 401, unauthorized)**:
  ```json
  {
    "statusCode": 401,
    "message": "Invalid token",
    "error": "Unauthorized"
  }

- **Response (Error - 404, job post not found)**:
  ```json
  {
    "statusCode": 404,
    "message": "Job post not found",
    "error": "Not Found"
  }

### 74.1 Notify Referral Applicants (Admin)
- **Endpoint**: `POST /api/admin/job-posts/:id/notify-referral-applicants`
- **Description**: Sends email notifications only to applicants who have previously applied via referral links for jobs in the same category as the specified vacancy. Allows you to select the recipient limit and the selection order by registration date.
- **Headers**: `Authorization: Bearer <token>`
- **Request Parameters**: `id`: The ID of the job post
- **Request Body**:
  ```json
  {
    "limit": 50,
    "orderBy": "end" // Options: "beginning", "end", "random"
  }

- **Response (Success - 200)**:
  ```json
  {
    "total": 120,
    "sent": 50,
    "jobPostId": "<jobPostId>"
  }

- **Response (Error - 400, invalid input)**:
  ```json
  {
    "statusCode": 400,
    "message": "Limit must be a positive integer",
    "error": "Bad Request"
  }

- **Response (Error - 400, no category)**:
  ```json
  {
    "statusCode": 400,
    "message": "Job post has no category assigned",
    "error": "Bad Request"
  }

- **Response (Error - 401, unauthorized)**:
  ```json
  {
    "statusCode": 401,
    "message": "Invalid token",
    "error": "Unauthorized"
  }

- **Response (Error - 404, job post not found)**:
  ```json
  {
    "statusCode": 404,
    "message": "Job post not found",
    "error": "Not Found"
  }  

### 75. Get Chat History (Admin)
- **Endpoint**: `GET /api/admin/chat/:jobApplicationId`
- **Description**: Retrieves the chat history for a specific job application. Admin-only.
- **Headers**: `Authorization: Bearer <token>` (Required, JWT token).
- **Path Parameters**: `jobApplicationId` (string, required): The ID of the job application.
- **Query Parameters**:
  - `page` (number, optional): Page number for pagination (default: 1).
  - `limit` (number, optional): Number of messages per page (default: 10).
- **Response (Success - 200)**:
  ```json
  {
    "total": 50,
    "data": [
      {
        "id": "<messageId>",
        "job_application_id": "<jobApplicationId>",
        "sender_id": "<userId>",
        "sender": { "id": "<userId>", "username": "john_doe", "email": "john@example.com", "role": "jobseeker" },
        "recipient_id": "<userId>",
        "recipient": { "id": "<userId>", "username": "jane_smith", "email": "jane@example.com", "role": "employer" },
        "content": "Hello, let's discuss the project!",
        "created_at": "2025-06-16T05:47:00.000Z",
        "is_read": false
      }
    ]
  }

- **Response (Error - 401, if token is invalid or user is not an admin)**:  
  ```json
  {
    "statusCode": 401,
    "message": "Invalid token",
    "error": "Unauthorized"
  }

- **Response (Error - 400, if pagination parameters are invalid)**:  
  ```json
  {
    "statusCode": 400,
    "message": "Page must be a positive integer",
    "error": "Bad Request"
  }

- **Response (Error - 404, if job application not found)**:  
  ```json
  {
    "statusCode": 404,
    "message": "Job application not found",
    "error": "Not Found"
  }

### 76. Get All Job Posts (Moderator)
- **Endpoint**: `GET /api/moderator/job-posts`
- **Description**: Retrieves all job posts (moderator or admin only) with optional filters, pagination, and sorting. Supports filtering by status, pending review status, and job title (partial match). Returns total count and paginated data for frontend pagination.
- **Headers**: `Authorization: Bearer <token>`
- **Query Parameters**:
  - `status` (string, optional): Filter by status ("Active", "Draft", "Closed").
  - `pendingReview` (string, optional): Filter by pending review status ("true" or "false").
  - `title` (string, optional): Filter by job title (partial match, case-insensitive).
  - `page` (number, optional): Page number for pagination (default: 1).
  - `limit` (number, optional): Number of items per page (default: 10).
- **Example Request**: `/api/moderator/job-posts?status=Active&pendingReview=false&title=Software&page=1&limit=10`
- **Response (Success - 200)**:
  ```json
  {
    "total": 50,
    "data": [
      {
        "id": "<jobPostId>",
        "title": "Software Engineer",
        "description": "We are looking for a skilled software engineer...",
        "location": "Remote",
        "salary": 50000,
        "status": "Active",
        "pending_review": false,
        "category_id": "<categoryId>",
        "category": {
          "id": "<categoryId>",
          "name": "Software Development",
          "created_at": "2025-05-15T06:12:00.000Z",
          "updated_at": "2025-05-15T06:12:00.000Z"
        },
        "job_type": "Full-time",
        "employer_id": "<employerId>",
        "employer": {
          "id": "<employerId>",
          "email": "employer100@example.com",
          "username": "jane_smith100",
          "role": "employer"
        },
        "views": 0,
        "required_skills": ["JavaScript", "TypeScript"],
        "created_at": "2025-05-15T06:12:00.000Z",
        "updated_at": "2025-05-15T06:12:00.000Z"
      }
    ]
  }
- **Response (Error - 400, if pagination parameters incorrect)**:
  ```json
  {
    "statusCode": 400,
    "message": "Page must be a positive integer",
    "error": "Bad Request"
  }
- **Response (Error - 401, if not authorized)**:
  ```json
  {
    "statusCode": 401,
    "message": "Only moderators or admins can access this resource",
    "error": "Unauthorized"
  }

### 77. Submit Success Story
- **Endpoint**: `POST /api/platform-feedback`
- **Description**: Allows authenticated jobseekers or employers to submit feedback or success stories about the platform.
- **Headers**: `Authorization: Bearer <token>`
- **Request Body**:
  ```json
  {
    "headline": "Landed my first remote role via Jobforge",
    "story": "I applied to 3 roles and got 2 interviews within a week...",
    "rating": 5,
    "allow_publish": true,
    "company": "Acme Inc",
    "country": "CA"
  }

- **Response (Success - 200)**:
  ```json
  {
    "id": "<id>",
    "user_id": "<userId>",
    "role": "jobseeker",
    "headline": "Landed my first remote role via Jobforge",
    "story": "I applied to 3 roles and got 2 interviews within a week...",
    "rating": 5,
    "allowed_to_publish": true,
    "is_public": true,
    "company": "Acme Inc",
    "country": "CA",
    "created_at": "2025-08-15T10:00:00.000Z",
    "updated_at": "2025-08-15T10:00:00.000Z"
  }

- **Response (Error - 400, if rating is invalid)**:
  ```json
  {
    "statusCode": 400,
    "message": "Rating must be between 1 and 5",
    "error": "Bad Request"
  }

- **Response (Error - 400, if description is missing)**:
  ```json
  {
    "statusCode": 400,
    "message": "Description is required",
    "error": "Bad Request"
  }

- **Response (Error - 401, if token is invalid or user is not jobseeker/employer)**:
  ```json
  {
    "statusCode": 401,
    "message": "Only jobseekers and employers can submit platform feedback",
    "error": "Unauthorized"
  }

- **Response (Error - 404, if user not found)**:
  ```json
  {
    "statusCode": 404,
    "message": "User not found",
    "error": "Not Found"
  }

### 78. Get Success Stories (Public)
- **Endpoint**: `GET /api/platform-feedback`
- **Description**: Retrieves a paginated list of platform feedback and success stories, accessible to all users (including unauthenticated). Returns only published (is_public=true)
- **Query Parameters**:
    - `page` (number, optional): Page number for pagination (default: 1).
    - `limit` (number, optional): Number of items per page (default: 10).
- **Example Request**: `/api/platform-feedback?page=1&limit=10`
- **Response (Success - 200)**:
  ```json
  {
    "total": 50,
    "data": [
      {
        "id": "<id>",
        "headline": "Hired in 10 days",
        "story": "Your platform matched me with a perfect role...",
        "rating": 5,
        "company": "Globex",
        "country": "SE",
        "created_at": "2025-08-01T12:00:00.000Z",
        "updated_at": "2025-08-01T12:00:00.000Z",
        "user": { "id": "<uid>", "username": "anna", "role": "jobseeker" }
      }
    ]
  }

- **Response (Error - 400, if pagination parameters are invalid)**:
  ```json
  {
    "statusCode": 400,
    "message": "Page must be a positive integer",
    "error": "Bad Request"
  }

### 79. Get Platform Feedback (Admin/Moderator)
- **Endpoint**: `GET /api/admin/platform-feedback`
- **Description**: Returns a paginated list of all success stories and reviews (both published and unpublished) for moderation.
- **Headers**: `Authorization: Bearer <token>`
- **Query Parameters**:
    - `page` (number, optional): Page number for pagination (default: 1).
    - `limit` (number, optional): Number of items per page (default: 10).
- **Example Request**: `/api/admin/platform-feedback?page=1&limit=10`
- **Response (Success - 200)**:
  ```json
  {
    "total": 42,
    "data": [
      {
        "id": "fdb-uuid",
        "user_id": "user-uuid",
        "role": "jobseeker",
        "headline": "Hired in 10 days",
        "story": "Your platform matched me with a perfect role...",
        "rating": 5,
        "allowed_to_publish": true,
        "is_public": true,
        "company": "Globex",
        "country": "SE",
        "created_at": "2025-08-12T10:00:00.000Z",
        "updated_at": "2025-08-12T10:00:00.000Z",
        "user": {
          "id": "user-uuid",
          "username": "anna",
          "role": "jobseeker"
        }
      }
    ]
  }

- **Response (Error - 400, if pagination parameters are invalid)**:
  ```json
  {
    "statusCode": 400,
    "message": "Page must be a positive integer",
    "error": "Bad Request"
  }

- **Response (Error - 401, if token is invalid or user is not an admin/moderator)**:
  ```json
  {
    "statusCode": 401,
    "message": "Only admins or moderators can access this resource",
    "error": "Unauthorized"
  }

### 79.1 Publish Platform Feedback (Admin/Moderator)
- **Endpoint**: `PATCH /api/admin/platform-feedback/:id/publish`
- **Description**: Publishes the story on the site (is_public = true). Allowed only if the user has checked the consent box (allowed_to_publish = true).
- **Headers**: `Authorization: Bearer <token>`
- **Params**:
    - `id` — ID записи платформенного фидбека
- **Response (Success - 200)**:
  ```json
  {
    "id": "fdb-uuid",
    "user_id": "user-uuid",
    "role": "employer",
    "headline": "Closed a hard role with Jobforge",
    "story": "Posting and screening saved us days...",
    "rating": 5,
    "allowed_to_publish": true,
    "is_public": true,
    "company": "Acme Inc",
    "country": "CA",
    "created_at": "2025-08-10T09:00:00.000Z",
    "updated_at": "2025-08-15T11:20:00.000Z"
  }

- **Response (400 Bad Request - no user consent to publish)**:
  ```json
  {
    "statusCode": 400,
    "message": "User did not allow publishing this story",
    "error": "Bad Request"
  }  

- **Response (Error - 401, if token is invalid or user is not an admin/moderator)**:
  ```json
  {
    "statusCode": 401,
    "message": "Only admins or moderators can access this resource",
    "error": "Unauthorized"
  }

### 79.2 Unpublish Platform Feedback (Admin/Moderator)
- **Endpoint**: `PATCH /api/admin/platform-feedback/:id/unpublish`
- **Description**: Removes publication (is_public = false).
- **Headers**: `Authorization: Bearer <token>`
- **Params**:
    - `id` — ID записи платформенного фидбека
- **Response (Success - 200)**:
  ```json
  {
    "id": "fdb-uuid",
    "user_id": "user-uuid",
    "role": "jobseeker",
    "headline": "Got my first remote role",
    "story": "After 2 interviews I got an offer...",
    "rating": 4,
    "allowed_to_publish": true,
    "is_public": false,
    "company": "Globex",
    "country": "SE",
    "created_at": "2025-08-09T08:30:00.000Z",
    "updated_at": "2025-08-15T11:22:00.000Z"
  }

- **Response (400 Bad Request - no user consent to publish)**:
  ```json
  {
    "statusCode": 400,
    "message": "User did not allow publishing this story",
    "error": "Bad Request"
  }  

- **Response (Error - 401, if token is invalid or user is not an admin/moderator)**:
  ```json
  {
    "statusCode": 401,
    "message": "Only admins or moderators can access this resource",
    "error": "Unauthorized"
  }

### 80. Delete Platform Feedback (Admin/Moderator)
- **Endpoint**: `DELETE /api/admin/platform-feedback/:id`
- **Description**: Deletes a specific platform feedback entry (admin or moderator only).
- **Headers**: `Authorization: Bearer <token>`
- **Request Parameters**: `id`: The ID of the feedback.
- **Example Request**: `/api/admin/platform-feedback?page=1&limit=10`
- **Response (Success - 200)**:
  ```json
  {
    "message": "Platform feedback deleted successfully"
  }

- **Response (Error - 404, if feedback not found)**:
  ```json
  {
    "statusCode": 404,
    "message": "Platform feedback not found",
    "error": "Not Found"
  }

- **Response (Error - 401, if token is invalid or user is not an admin/moderator)**:
  ```json
  {
    "statusCode": 401,
    "message": "Only admins or moderators can access this resource",
    "error": "Unauthorized"
  }

### 81. Reject Job Post (Admin)
- **Endpoint**: `POST /api/admin/job-posts/:id/reject`
- **Description**: Rejects a job post by deleting it and sending a notification to the employer with the reason for rejection (admin only).
- **Headers**: `Authorization: Bearer <token>`
- **Request Parameters**: `id`: The ID of the job post.
- **Request Body**:
  ```json
  {
    "reason": "Inappropriate content in job description"
  }
- **Response (Success - 200)**:
  ```json
  {
    "message": "Job post rejected successfully",
    "reason": "Inappropriate content in job description"
  }

- **Response (Error - 400, if reason is missing)**:
  ```json
  {
    "statusCode": 400,
    "message": "Reason for rejection is required",
    "error": "Bad Request"
  }

- **Response (Error - 401, if token is invalid or user is not an admin)**:
  ```json
  {
    "statusCode": 401,
    "message": "Invalid token",
    "error": "Unauthorized"
  }

- **Response (Error - 404, if job post not found)**:
  ```json
  {
    "statusCode": 404,
    "message": "Job post not found",
    "error": "Not Found"
  }

### 82. Get Email Notification Stats for Job Post (Admin)
- **Endpoint**: `GET /api/admin/job-posts/:id/email-stats`
- **Description**: Retrieves email notification statistics and details for a specific job post, including sent, opened, clicked counts and per-email details (admin only).
- **Headers**: `Authorization: Bearer <token>`
- **Request Parameters**: `id`: The ID of the job post.
- **Response (Success - 200)**:
  ```json
  {
    "sent": 20,
    "opened": 10,
    "clicked": 5,
    "details": [
      {
        "email": "user1@example.com",
        "username": "user1",
        "opened": true,
        "clicked": false,
        "sent_at": "2025-07-28T12:00:00.000Z",
        "opened_at": "2025-07-28T12:05:00.000Z",
        "clicked_at": null
      }
    ]
  }

- **Response (Error - 401, if token is invalid or user is not an admin)**:
  ```json
  {
  "statusCode": 401,
  "message": "Invalid token",
  "error": "Unauthorized"
  }

- **Response (Error - 404, if job post not found)**:
  ```json
  {
    "statusCode": 404,
    "message": "Job post not found",
    "error": "Not Found"
  }

### 83. Get All Email Notification Stats (Admin)
- **Endpoint**: `GET /api/admin/email-stats`
- **Description**: Retrieves overall email notification statistics and details across all job posts, with optional filters by jobPostId, title (partial/full), employerId, employerEmail (partial), employerUsername (partial) (admin only).
- **Headers**: `Authorization: Bearer <token>`
- **Request Parameters**: `id`: The ID of the job post.
- **Query Parameters**: 
  - `jobPostId` (string, optional): Filter by specific job post ID.
  - `title` (string, optional): Filter by job post title (partial match).
  - `employerId` (string, optional): Filter by employer ID.
  - `employerEmail` (string, optional): Filter by employer email (partial match).
  - `employerUsername` (string, optional): Filter by employer username (partial match).
- **Response (Success - 200)**:
  ```json
  {
    "sent": 100,
    "opened": 50,
    "clicked": 20,
    "details": [
      {
        "job_post_id": "<jobPostId>",
        "email": "user1@example.com",
        "username": "user1",
        "opened": true,
        "clicked": false,
        "sent_at": "2025-07-28T12:00:00.000Z",
        "opened_at": "2025-07-28T12:05:00.000Z",
        "clicked_at": null
      }
    ]
  }

- **Response (Error - 401, if token is invalid or user is not an admin)**:
  ```json
  {
  "statusCode": 401,
  "message": "Invalid token",
  "error": "Unauthorized"
  }

### 84. Create Referral Link for Job Post (Admin)
- **Endpoint**: `POST /api/admin/job-posts/:id/referral-links`
- **Description**: Creates a new referral link for the given job post. Multiple links per job post are allowed.
- **Headers**: `Authorization: Bearer <token>`
- **Body**: 
  ```json
  { 
    "description": "Facebook Ads, campaign A" // optional
  }  
- **Response (Success - 200)**:
  ```json
  {
    "id": "<linkId>",
    "refCode": "<uuid>",
    "jobPostId": "<jobPostId>",
    "description": "Facebook Ads, campaign A",
    "clicks": 0,
    "registrations": 0,

    "landingPath": "/job/<slug_id>",
    "fullLink": "https://jobforge.net/job/<slug_id>?ref=<uuid>",
    "legacyLink": "https://jobforge.net/ref/<uuid>"
  }
- **Error: 404 if job post not found, 401 if not admin.**

### 85. Get All Referral Links (Admin)
- **Endpoint**: `GET /api/admin/referral-links`
- **Description**: Retrieves all generated referral links with details (job post, clicks, registrations, registered users). Supports filters jobId and jobTitle.
- **Query**: jobId (optional), jobTitle (optional, partial match).
- **Headers**: `Authorization: Bearer <token>`
- **Response (Success - 200)**:
  ```json
  [
    {
      "id": "<linkId>",
      "refCode": "<uuid>",
      "jobPostId": "<jobId>",
      "job_post": {
        "id": "<jobId>",
        "title": "Job Title",
        "slug": "job-title-remote",
        "slug_id": "job-title-remote--8df3b0be"
      },
      "description": "Facebook Ads, campaign A",
      "clicks": 10,
      "registrations": 5,
      "registrationsDetails": [ /* ... */ ],
      "created_at": "2025-07-31T00:00:00.000Z",

      "landingPath": "/job/<slug_id>",
      "fullLink": "https://jobforge.net/job/<slug_id>?ref=<uuid>",
      "legacyLink": "https://jobforge.net/ref/<uuid>"
    }
  ]
- **Error: 401 if not admin.**

### 85.1 List Referral Links by Job Post (Admin)
- **Endpoint**: `GET /api/admin/job-posts/:id/referral-links`
- **Description**: Lists all referral links for a job post.
- **Response (Success - 200)**:
  ```json
  [
    {
      "id": "<linkId>",
      "refCode": "<uuid>",
      "jobPostId": "<jobId>",
      "description": "YouTube Influencer X",
      "clicks": 3,
      "registrations": 1,
      "created_at": "2025-08-12T11:12:00.000Z",
  
      "landingPath": "/job/<slug_id>",
      "fullLink": "https://jobforge.net/job/<slug_id>?ref=<uuid>",
      "legacyLink": "https://jobforge.net/ref/<uuid>"
    }
  ]

### 85.2 Update Referral Link Description (Admin)
- **Endpoint**: `PUT /api/admin/referral-links/:linkId`
- **Description**: Lists all referral links for a job post.
- **Body**: 
  ```json
  { 
    "description": "YouTube Influencer X" 
  }  

### 85.3 Delete Referral Link (Admin)
- **Endpoint**: `DELETE /api/admin/referral-links/:linkId`

### 86. Referral Redirect (Public)
- **Endpoint**: `GET /ref/:refCode`
- **Description**: Increments click count and redirects to the job post page.
- **Response: Redirect to /jobs/<jobid>, or 404 if invalid.</jobid>**

### 86.1 Track Referral Click (Public)
- **Endpoint**: `POST /api/ref/track`
- **Description**: Регистрирует клик по рефкоду на SPA-лендинге (когда открывается /job/<slug_id>?ref=<refCode>). Вызывать один раз при первом маунте страницы.
- **Response: { "ok": true, "jobPostId": "<jobPostId>" }**

### 87. Get Chat History
- **Endpoint**: `GET /api/chat/:jobApplicationId`
- **Description**: Retrieves the chat history for a specific job application with pagination. Accessible only to the jobseeker or employer associated with the accepted job application. Messages are ordered by `created_at` in ascending order.
- **Headers**: `Authorization: Bearer <token>` (Required, JWT token).
- **Path Parameters**: `jobApplicationId` (string, required): The ID of the job application.
- **Query Parameters**: 
  - `page` (number, optional): Page number for pagination (default: 1).
  - `limit` (number, optional): Number of messages per page (default: 10).
- **Response (Success - 200)**:
  ```json
  {
    "total": 50,
    "data": [
      {
        "id": "<messageId>",
        "job_application_id": "<jobApplicationId>",
        "sender_id": "<userId>",
        "sender": {
          "id": "<userId>",
          "username": "john_doe",
          "email": "john@example.com",
          "role": "jobseeker"
        },
        "recipient_id": "<userId>",
        "recipient": {
          "id": "<userId>",
          "username": "jane_smith",
          "email": "jane@example.com",
          "role": "employer"
        },
        "content": "Hello, let's discuss the project!",
        "created_at": "2025-06-16T05:47:00.000Z",
        "is_read": false
      }
    ]
  }

- **Response (Error - 401, if token is invalid or user lacks access)**:
  ```json
  {
    "statusCode": 401,
    "message": "Invalid token",  // or "No access to this chat"
    "error": "Unauthorized"
  }

- **Response (Error - 400, if pagination parameters are invalid)**:
  ```json
  {
    "statusCode": 400,
    "message": "Page must be a positive integer",  // or similar for limit
    "error": "Bad Request"
  }

- **Response (Error - 404, if job application not found or not accepted)**:
  ```json
  {
    "statusCode": 404,
    "message": "Job application not found",  // or "Chat is only available for accepted applications"
    "error": "Not Found"
  }

### 88. Get Job Posts by Main Categories Stats
- **Endpoint**: `GET /stats/job-posts-by-main-categories`
- **Description**: Description: Retrieves statistics on the number of active job posts (vacancies) for each main category (categories without a parent_id), including the count of active job posts from their subcategories (recursive). Only active and approved job posts are counted (status = 'Active', pending_review = false). Excludes categories with zero job posts. Results are sorted by count in descending order.
- **Headers**: None (public endpoint)
- **Request Body**: None
- **Response (Success - 200)**:
  ```json
  [
    { "categoryId": "<mainCatId>", "categoryName": "Development", "count": 42 }
  ]

- **Response (Error - 500, if internal error)**:
  ```json
  {
    "statusCode": 500,
    "message": "Internal server error",
    "error": "Internal Server Error"
  }

### 89. Get Job Posts by Subcategories Stats
- **Endpoint**: `GET /stats/job-posts-by-subcategories`
- **Description**: Retrieves statistics on the number of active job posts (vacancies) for each subcategory (categories with a parent_id), counting only the job posts directly associated with the subcategory (no recursive counting). Only active and approved job posts are counted (status = 'Active', pending_review = false). Excludes subcategories with zero job posts. Results are sorted by count in descending order.
- **Headers**: None (public endpoint)
- **Request Body**: None
- **Response (Success - 200)**:
  ```json
  [
    { "categoryId": "<subCatId>", "categoryName": "Frontend", "count": 17 }
  ]

- **Response (Error - 500, if internal error)**:
  ```json
  {
    "statusCode": 500,
    "message": "Internal server error",
    "error": "Internal Server Error"
  }  

### 90. Contact — Send a message
- **Endpoint:** `POST /api/contact`
- **Description:** Sends a message from the website contact form to the support inbox (support@jobforge.net) via Brevo. Single endpoint, two modes:
  - **Guest (public):** no JWT, CAPTCHA required, strict rate-limit by IP, honeypot, link ban.
  - **Dashboard (authenticated):** valid JWT, no CAPTCHA, softer rate-limit by userId, name/email auto-filled.
- **Request Body**:
  ```json
  {
    "name": "Jane Doe",
    "email": "jane@example.com",
    "message": "Hello! I'd like to know more about JobForge.",
    "captchaToken": "token-from-recaptcha-or-hcaptcha",
    "website": ""
  }
- **Guest:** name, email, message, captchaToken required (honeypot website must be empty).
- **Dashboard:** send the same shape; name, email, captchaToken are ignored if JWT is valid (server uses account data).
- **Auth:**
  - Optional JWT `(Authorization: Bearer <token>)`. If present and valid, the request is treated as Dashboard mode.
- **Spam & abuse protection:**
  - `Rate limit`: Guest — 3 req / 60s per IP; Dashboard — 10 req / 60s per userId.
  - `Honeypot`: website must be empty (else 403).
  - `Link ban`: messages containing links/HTML are rejected (400).
  - `CAPTCHA`: required for Guests; not required for Dashboard.
  - `Email delivery`: Brevo template (templateId=6) with params { fromName, fromEmail, message }. Reply-To = user email; To = support@jobforge.net.
- **Validation rules**:
  - `name` — string, 2–100 chars
  - `email` — valid email, ≤254 chars
  - `message` — 10–2000 chars, links/HTML not allowed
  - `website` — honeypot field, must be empty (hidden in UI)
  - `captchaToken` — optional; if CAPTCHA is enabled in config, it must pass verification
- **Response (202 Accepted)**:
  ```json
  { "message": "Message accepted" }

### 91. Get Chat Notification Settings (Admin)
- **Endpoint:** `GET /api/admin/settings/chat-notifications`
- **Description:** Returns global chat email-notification settings (admin only).
- **Headers**: `Authorization: Bearer <token>`
- **Response (Success - 200)**:
  ```json
  {
    "enabled": true,
    "onEmployerMessage": {
      "immediate": true,
      "delayedIfUnread": { "enabled": true, "minutes": 60 },
      "after24hIfUnread": { "enabled": true, "hours": 24 },   // NEW
      "onlyFirstMessageInThread": false
    },
    "throttle": { "perChatCount": 2, "perMinutes": 60 }
  }

- **Response 401**:
  ```json
  { "statusCode": 401, "message": "Unauthorized", "error": "Unauthorized" }

### 92. Update Chat Notification Settings (Admin)
- **Endpoint:** `POST /api/admin/settings/chat-notifications`
- **Description:** Updates global chat email-notification settings (admin only).
- **Headers**: `Authorization: Bearer <token>`
- **Request Body:**:
  ```json
  {
    "enabled": true,
    "onEmployerMessage": {
      "immediate": true,
      "delayedIfUnread": { "enabled": true, "minutes": 60 },
      "after24hIfUnread": { "enabled": true, "hours": 24 },   // NEW
      "onlyFirstMessageInThread": false
    },
    "throttle": { "perChatCount": 2, "perMinutes": 60 }
  }

- **Response (200)**:
  ```json
  {
    "message": "Chat notification settings updated",
    "settings": { ...same as you sent... }
  }
- **Notes**:
  - `immediate`: send right away when employer writes to jobseeker.
  - `delayedIfUnread`: also send if still unread after minutes.
  - `onlyFirstMessageInThread`: if true, notify only on the first message in a given chat thread.
  - `throttle`: не чаще X раз в N минут для одного чата и получателя (anti-spam).